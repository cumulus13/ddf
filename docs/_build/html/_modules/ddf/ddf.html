

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ddf.ddf &mdash; DDF 0.37.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=71b83207"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            DDF
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#basic-installation">Basic Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#optional-dependencies">Optional Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#all-features">All Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#cache-backends">Cache Backends</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#server-mode">Server Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#file-monitoring">File Monitoring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#development-installation">Development Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#verification">Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#platform-specific-notes">Platform-Specific Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#linux">Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#macos">macOS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#upgrading">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#uninstallation">Uninstallation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#basic-workflow">Basic Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#common-tasks">Common Tasks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#finding-duplicate-ports">Finding Duplicate Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#editing-service-configuration">Editing Service Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#creating-new-services">Creating New Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#duplicating-services">Duplicating Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#managing-dockerfiles">Managing Dockerfiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#working-with-entrypoints">Working with Entrypoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quickstart.html#port-management">Port Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#editor-selection">Editor Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html#configuration-file-location">Configuration File Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html#configuration-sections">Configuration Sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#docker-compose-settings">Docker Compose Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#editor-settings">Editor Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#cache-settings">Cache Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#backup-settings">Backup Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#server-mode-settings">Server Mode Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#docker-settings">Docker Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html#complete-example">Complete Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html#configuration-validation">Configuration Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#configuration-not-found">Configuration Not Found</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#cache-connection-issues">Cache Connection Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.html#editor-not-found">Editor Not Found</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#command-line-interface">Command Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#basic-syntax">Basic Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#global-options">Global Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#service-information">Service Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#list-services">List Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#show-service-details">Show Service Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#show-service-ports">Show Service Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#show-service-volumes">Show Service Volumes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#show-service-devices">Show Service Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#show-service-hostname">Show Service Hostname</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#port-management">Port Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#find-duplicate-ports">Find Duplicate Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#find-port-usage">Find Port Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#check-port-duplication">Check Port Duplication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#service-editing">Service Editing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#edit-service-configuration">Edit Service Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#edit-dockerfile">Edit Dockerfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#edit-entrypoint-script">Edit Entrypoint Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#edit-specific-file">Edit Specific File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#set-dockerfile-path">Set Dockerfile Path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#service-management">Service Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#create-new-service">Create New Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#duplicate-service">Duplicate Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#rename-service">Rename Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#remove-service">Remove Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#copy-service-to-clipboard">Copy Service to Clipboard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#copy-dockerfile-to-clipboard">Copy Dockerfile to Clipboard</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#reading-files">Reading Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#read-dockerfile">Read Dockerfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#read-entrypoint">Read Entrypoint</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#read-specific-file">Read Specific File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#advanced-features">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#pattern-matching">Pattern Matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#detached-mode">Detached Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#filtering">Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#theme-customization">Theme Customization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#batch-operations">Batch Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#process-multiple-services">Process Multiple Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#export-all-services">Export All Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#backup-all-dockerfiles">Backup All Dockerfiles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#exit-codes">Exit Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#typical-workflow">Typical Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#port-conflict-resolution">Port Conflict Resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#service-migration">Service Migration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../server_mode.html">Server Mode</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#benefits">Benefits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#client-server-model">Client-Server Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#command-routing">Command Routing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#starting-server">Starting Server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#manual-start">Manual Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#with-tray-icon">With Tray Icon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#enable-auto-forwarding">Enable Auto-forwarding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#systemd-service-linux">Systemd Service (Linux)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#create-service-file">Create Service File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#enable-and-start">Enable and Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#user-service-linux">User Service (Linux)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#windows-service">Windows Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#using-nssm">Using NSSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#using-task-scheduler">Using Task Scheduler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#macos-launchagent">macOS LaunchAgent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#create-launch-agent">Create Launch Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#load-and-start">Load and Start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#docker-container">Docker Container</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#dockerfile">Dockerfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#build-and-run">Build and Run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#docker-compose">Docker Compose</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#health-monitoring">Health Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#check-server-status">Check Server Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#manual-check">Manual Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#python-api">Python API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#server-won-t-start">Server Wonâ€™t Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#commands-not-forwarded">Commands Not Forwarded</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#notifications-not-working">Notifications Not Working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../server_mode.html#performance-issues">Performance Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../server_mode.html#security-considerations">Security Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../caching.html">Caching System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#cache-keys">Cache Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#cache-invalidation">Cache Invalidation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#automatic-invalidation">Automatic Invalidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#manual-invalidation">Manual Invalidation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#cache-backends">Cache Backends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#pickle-backend">Pickle Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#redis-backend">Redis Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#redis-with-pickle-serialization">Redis with Pickle Serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#memcached-backend">Memcached Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#memcached-with-pickle">Memcached with Pickle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#ini-file">INI File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#ttl-settings">TTL Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#basic-operations">Basic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#complex-data">Complex Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#pattern-operations">Pattern Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#using-decorator">Using Decorator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#performance-optimization">Performance Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#best-practices">Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#benchmark-results">Benchmark Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#monitoring">Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#check-cache-status">Check Cache Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#redis-monitoring">Redis Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#memcached-monitoring">Memcached Monitoring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../caching.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#cache-not-working">Cache Not Working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#connection-errors">Connection Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#ttl-not-working">TTL Not Working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../caching.html#memory-issues">Memory Issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../backup.html">Backup &amp; Recovery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#backup-operations">Backup Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#when-backups-are-created">When Backups Are Created</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#backup-file-format">Backup File Format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#backup-directory">Backup Directory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#using-backups">Using Backups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#listing-backups">Listing Backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#manual-backup">Manual Backup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#restoring-backups">Restoring Backups</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#advanced-usage">Advanced Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#enhanced-backup-manager">Enhanced Backup Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#checking-if-backup-should-be-created">Checking if Backup Should Be Created</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#batch-operations">Batch Operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#best-practices">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#regular-cleanup">Regular Cleanup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#backup-storage">Backup Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#version-control-integration">Version Control Integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#recovery-scenarios">Recovery Scenarios</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#accidental-deletion">Accidental Deletion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#bad-edit">Bad Edit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#system-crash">System Crash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#compare-versions">Compare Versions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../backup.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#backup-not-created">Backup Not Created</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#backup-directory-full">Backup Directory Full</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../backup.html#cannot-restore-backup">Cannot Restore Backup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/core.html">Core API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#ddf-class">DDF Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.DDF"><code class="docutils literal notranslate"><span class="pre">DDF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.__init__"><code class="docutils literal notranslate"><span class="pre">DDF.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.THEME"><code class="docutils literal notranslate"><span class="pre">DDF.THEME</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.open_file"><code class="docutils literal notranslate"><span class="pre">DDF.open_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.find_service"><code class="docutils literal notranslate"><span class="pre">DDF.find_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.show_service_detail"><code class="docutils literal notranslate"><span class="pre">DDF.show_service_detail()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.find_duplicate_port"><code class="docutils literal notranslate"><span class="pre">DDF.find_duplicate_port()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.find_port"><code class="docutils literal notranslate"><span class="pre">DDF.find_port()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.check_duplicate_port"><code class="docutils literal notranslate"><span class="pre">DDF.check_duplicate_port()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_service_devices"><code class="docutils literal notranslate"><span class="pre">DDF.list_service_devices()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_service_volumes"><code class="docutils literal notranslate"><span class="pre">DDF.list_service_volumes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_volumes"><code class="docutils literal notranslate"><span class="pre">DDF.list_volumes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_hostnames"><code class="docutils literal notranslate"><span class="pre">DDF.list_hostnames()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_service_ports"><code class="docutils literal notranslate"><span class="pre">DDF.list_service_ports()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.get_list_service_names"><code class="docutils literal notranslate"><span class="pre">DDF.get_list_service_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.list_service_names"><code class="docutils literal notranslate"><span class="pre">DDF.list_service_names()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.get_dockerfile"><code class="docutils literal notranslate"><span class="pre">DDF.get_dockerfile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.read_dockerfile"><code class="docutils literal notranslate"><span class="pre">DDF.read_dockerfile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.read_entrypoint1"><code class="docutils literal notranslate"><span class="pre">DDF.read_entrypoint1()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.read_entrypoint2"><code class="docutils literal notranslate"><span class="pre">DDF.read_entrypoint2()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.read_entrypoint"><code class="docutils literal notranslate"><span class="pre">DDF.read_entrypoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.edit_entrypoint"><code class="docutils literal notranslate"><span class="pre">DDF.edit_entrypoint()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.edit_dockerfile"><code class="docutils literal notranslate"><span class="pre">DDF.edit_dockerfile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.edit_service"><code class="docutils literal notranslate"><span class="pre">DDF.edit_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.edit_file"><code class="docutils literal notranslate"><span class="pre">DDF.edit_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.read_file"><code class="docutils literal notranslate"><span class="pre">DDF.read_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.set_dockerfile"><code class="docutils literal notranslate"><span class="pre">DDF.set_dockerfile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.new_service"><code class="docutils literal notranslate"><span class="pre">DDF.new_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.copy_service"><code class="docutils literal notranslate"><span class="pre">DDF.copy_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.rename_service"><code class="docutils literal notranslate"><span class="pre">DDF.rename_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.copy_dockerfile"><code class="docutils literal notranslate"><span class="pre">DDF.copy_dockerfile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.copy_dockerfile_config"><code class="docutils literal notranslate"><span class="pre">DDF.copy_dockerfile_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.duplicate_server"><code class="docutils literal notranslate"><span class="pre">DDF.duplicate_server()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.remove_service"><code class="docutils literal notranslate"><span class="pre">DDF.remove_service()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.get_version"><code class="docutils literal notranslate"><span class="pre">DDF.get_version()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.show_debug"><code class="docutils literal notranslate"><span class="pre">DDF.show_debug()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.get_content"><code class="docutils literal notranslate"><span class="pre">DDF.get_content()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.DDF.usage"><code class="docutils literal notranslate"><span class="pre">DDF.usage()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#enhancedddf-class">EnhancedDDF Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF.edit_service_enhanced"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF.edit_service_enhanced()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF.edit_dockerfile_enhanced"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF.edit_dockerfile_enhanced()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF.edit_entrypoint_enhanced"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF.edit_entrypoint_enhanced()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF.remove_service_enhanced"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF.remove_service_enhanced()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.EnhancedDDF.usage_enhanced"><code class="docutils literal notranslate"><span class="pre">EnhancedDDF.usage_enhanced()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#usage-class">Usage Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.Usage"><code class="docutils literal notranslate"><span class="pre">Usage</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/core.html#ddf.Usage.usage"><code class="docutils literal notranslate"><span class="pre">Usage.usage()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#decorators">Decorators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.cache_with_invalidation"><code class="docutils literal notranslate"><span class="pre">cache_with_invalidation()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/core.html#constants">Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.CONFIGFILE"><code class="docutils literal notranslate"><span class="pre">ddf.CONFIGFILE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.CONFIG"><code class="docutils literal notranslate"><span class="pre">ddf.CONFIG</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.CACHE"><code class="docutils literal notranslate"><span class="pre">ddf.CACHE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/core.html#ddf.CACHE_CONFIG"><code class="docutils literal notranslate"><span class="pre">ddf.CACHE_CONFIG</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cache.html">Cache API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#cachemanager-class">CacheManager Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager"><code class="docutils literal notranslate"><span class="pre">CacheManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.__new__"><code class="docutils literal notranslate"><span class="pre">CacheManager.__new__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager._get_client"><code class="docutils literal notranslate"><span class="pre">CacheManager._get_client()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager._serialize"><code class="docutils literal notranslate"><span class="pre">CacheManager._serialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager._deserialize"><code class="docutils literal notranslate"><span class="pre">CacheManager._deserialize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager._get_pickle_path"><code class="docutils literal notranslate"><span class="pre">CacheManager._get_pickle_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager._register_cache_key"><code class="docutils literal notranslate"><span class="pre">CacheManager._register_cache_key()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.__init__"><code class="docutils literal notranslate"><span class="pre">CacheManager.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.cleanup"><code class="docutils literal notranslate"><span class="pre">CacheManager.cleanup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.get"><code class="docutils literal notranslate"><span class="pre">CacheManager.get()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.set"><code class="docutils literal notranslate"><span class="pre">CacheManager.set()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.delete"><code class="docutils literal notranslate"><span class="pre">CacheManager.delete()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.invalidate_pattern"><code class="docutils literal notranslate"><span class="pre">CacheManager.invalidate_pattern()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheManager.flush_all"><code class="docutils literal notranslate"><span class="pre">CacheManager.flush_all()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#cacheconfig-class">CacheConfig Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig"><code class="docutils literal notranslate"><span class="pre">CacheConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.backend"><code class="docutils literal notranslate"><span class="pre">CacheConfig.backend</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.ttl"><code class="docutils literal notranslate"><span class="pre">CacheConfig.ttl</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.enabled"><code class="docutils literal notranslate"><span class="pre">CacheConfig.enabled</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.memcached_servers"><code class="docutils literal notranslate"><span class="pre">CacheConfig.memcached_servers</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.redis_host"><code class="docutils literal notranslate"><span class="pre">CacheConfig.redis_host</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.redis_port"><code class="docutils literal notranslate"><span class="pre">CacheConfig.redis_port</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.redis_password"><code class="docutils literal notranslate"><span class="pre">CacheConfig.redis_password</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.redis_db"><code class="docutils literal notranslate"><span class="pre">CacheConfig.redis_db</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.pickle_dir"><code class="docutils literal notranslate"><span class="pre">CacheConfig.pickle_dir</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheConfig.__init__"><code class="docutils literal notranslate"><span class="pre">CacheConfig.__init__()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#cachebackend-enum">CacheBackend Enum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend"><code class="docutils literal notranslate"><span class="pre">CacheBackend</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.NONE"><code class="docutils literal notranslate"><span class="pre">CacheBackend.NONE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.PICKLE"><code class="docutils literal notranslate"><span class="pre">CacheBackend.PICKLE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.MEMCACHED"><code class="docutils literal notranslate"><span class="pre">CacheBackend.MEMCACHED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.MEMCACHED_PICKLE"><code class="docutils literal notranslate"><span class="pre">CacheBackend.MEMCACHED_PICKLE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.REDIS"><code class="docutils literal notranslate"><span class="pre">CacheBackend.REDIS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/cache.html#ddf.CacheBackend.REDIS_PICKLE"><code class="docutils literal notranslate"><span class="pre">CacheBackend.REDIS_PICKLE</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#cache-backend-comparison">Cache Backend Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#pickle-backend">Pickle Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#redis-backend">Redis Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#memcached-backend">Memcached Backend</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#configuration-examples">Configuration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#id1">Pickle Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#id2">Redis Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#id3">Memcached Backend</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#basic-caching">Basic Caching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#pattern-invalidation">Pattern Invalidation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#flush-all">Flush All</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#decorator-usage">Decorator Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#performance-tips">Performance Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/cache.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#cache-not-working">Cache Not Working</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/cache.html#connection-errors">Connection Errors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/server.html">Server API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#ddfserver-class">DDFServer Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#ddf.DDFServer"><code class="docutils literal notranslate"><span class="pre">DDFServer</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.__init__"><code class="docutils literal notranslate"><span class="pre">DDFServer.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.health_check"><code class="docutils literal notranslate"><span class="pre">DDFServer.health_check()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.handle_client"><code class="docutils literal notranslate"><span class="pre">DDFServer.handle_client()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.run_server"><code class="docutils literal notranslate"><span class="pre">DDFServer.run_server()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.setup_tray"><code class="docutils literal notranslate"><span class="pre">DDFServer.setup_tray()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.DDFServer.quit_app"><code class="docutils literal notranslate"><span class="pre">DDFServer.quit_app()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#server-functions">Server Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#lock-management">Lock Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.acquire_lock"><code class="docutils literal notranslate"><span class="pre">acquire_lock()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.release_lock"><code class="docutils literal notranslate"><span class="pre">release_lock()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.is_server_running"><code class="docutils literal notranslate"><span class="pre">is_server_running()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#communication">Communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.send_to_server"><code class="docutils literal notranslate"><span class="pre">send_to_server()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.execute_command_in_server"><code class="docutils literal notranslate"><span class="pre">execute_command_in_server()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#notification">Notification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.notify_user"><code class="docutils literal notranslate"><span class="pre">notify_user()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#ddf.create_emoji_icon"><code class="docutils literal notranslate"><span class="pre">create_emoji_icon()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#server-configuration">Server Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#configuration-options">Configuration Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#environment-variables">Environment Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#SERVER_HOST"><code class="docutils literal notranslate"><span class="pre">SERVER_HOST</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#SERVER_PORT"><code class="docutils literal notranslate"><span class="pre">SERVER_PORT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#SERVER_ACTIVE"><code class="docutils literal notranslate"><span class="pre">SERVER_ACTIVE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/server.html#LOCK_FILE"><code class="docutils literal notranslate"><span class="pre">LOCK_FILE</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#starting-server">Starting Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#checking-server-status">Checking Server Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#sending-commands">Sending Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#server-health-check">Server Health Check</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#server-communication-protocol">Server Communication Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#request-format">Request Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#response-format">Response Format</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#server-flow">Server Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#tray-icon-integration">Tray Icon Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#auto-forwarding">Auto-forwarding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#systemd-integration">Systemd Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#linux-service">Linux Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#windows-service">Windows Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#docker-container">Docker Container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#security-considerations">Security Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/server.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#server-won-t-start">Server Wonâ€™t Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#commands-not-forwarded">Commands Not Forwarded</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/server.html#notifications-not-working">Notifications Not Working</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/backup.html">Backup API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#backupmanager-class">BackupManager Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager"><code class="docutils literal notranslate"><span class="pre">BackupManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager.get_backup_dir"><code class="docutils literal notranslate"><span class="pre">BackupManager.get_backup_dir()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager.create_backup"><code class="docutils literal notranslate"><span class="pre">BackupManager.create_backup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager.restore_from_backup"><code class="docutils literal notranslate"><span class="pre">BackupManager.restore_from_backup()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager.list_backups"><code class="docutils literal notranslate"><span class="pre">BackupManager.list_backups()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.BackupManager.prompt_restore_backup"><code class="docutils literal notranslate"><span class="pre">BackupManager.prompt_restore_backup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#enhancedbackupmanager-class">EnhancedBackupManager Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#ddf.EnhancedBackupManager"><code class="docutils literal notranslate"><span class="pre">EnhancedBackupManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.EnhancedBackupManager.create_backup_with_context"><code class="docutils literal notranslate"><span class="pre">EnhancedBackupManager.create_backup_with_context()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/backup.html#ddf.EnhancedBackupManager.should_create_backup"><code class="docutils literal notranslate"><span class="pre">EnhancedBackupManager.should_create_backup()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#basic-backup">Basic Backup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#backup-with-context">Backup with Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#list-backups">List Backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#restore-backup">Restore Backup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#interactive-restore">Interactive Restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#check-if-backup-needed">Check if Backup Needed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#backup-directory">Backup Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#integration-examples">Integration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#with-error-handling">With Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#automated-cleanup">Automated Cleanup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#backup-verification">Backup Verification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#backup-history">Backup History</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#constants">Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#id1">Backup Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#backup-file-pattern">Backup File Pattern</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/backup.html#error-handling">Error Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#common-exceptions">Common Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/backup.html#handling-failed-backups">Handling Failed Backups</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/editor.html">Editor API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#editormanager-class">EditorManager Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager"><code class="docutils literal notranslate"><span class="pre">EditorManager</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.BLOCKING_EDITORS"><code class="docutils literal notranslate"><span class="pre">EditorManager.BLOCKING_EDITORS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.NON_BLOCKING_EDITORS"><code class="docutils literal notranslate"><span class="pre">EditorManager.NON_BLOCKING_EDITORS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.SPECIAL_HANDLING"><code class="docutils literal notranslate"><span class="pre">EditorManager.SPECIAL_HANDLING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.edit_file_with_monitoring"><code class="docutils literal notranslate"><span class="pre">EditorManager.edit_file_with_monitoring()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.get_editor_type"><code class="docutils literal notranslate"><span class="pre">EditorManager.get_editor_type()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../api/editor.html#ddf.EditorManager.cleanup_temp_files"><code class="docutils literal notranslate"><span class="pre">EditorManager.cleanup_temp_files()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#editor-types">Editor Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#blocking-editors">Blocking Editors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#non-blocking-editors">Non-Blocking Editors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#special-handling">Special Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#basic-file-editing">Basic File Editing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#with-detached-mode">With Detached Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#custom-callback">Custom Callback</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#multiple-files">Multiple Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#file-hash-utilities">File Hash Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#get-file-hash">Get File Hash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#detect-changes">Detect Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#cleanup-operations">Cleanup Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#cleanup-temp-files">Cleanup Temp Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#scheduled-cleanup">Scheduled Cleanup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#advanced-features">Advanced Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#detached-terminal">Detached Terminal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#sublime-text-wait-mode">Sublime Text Wait Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#file-monitoring">File Monitoring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#editor-priority">Editor Priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#platform-specific-config">Platform-Specific Config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#error-handling">Error Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#editor-not-found">Editor Not Found</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#timeout-handling">Timeout Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#permission-errors">Permission Errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/editor.html#integration-examples">Integration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#with-ddf-edit-operations">With DDF Edit Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/editor.html#custom-editor-wrapper">Custom Editor Wrapper</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to DDF</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#ways-to-contribute">Ways to Contribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#development-setup">Development Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#development-workflow">Development Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#code-standards">Code Standards</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#code-style">Code Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#testing">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#commit-messages">Commit Messages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#pull-request-process">Pull Request Process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#pull-request-template">Pull Request Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#reporting-bugs">Reporting Bugs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#bug-report-template">Bug Report Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#feature-requests">Feature Requests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#feature-request-template">Feature Request Template</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#development-guidelines">Development Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#architecture">Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#performance">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#security">Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#adding-new-features">Adding New Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#cache-backend-example">Cache Backend Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contributing.html#editor-support-example">Editor Support Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#mit-license">MIT License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#third-party-licenses">Third-Party Licenses</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../license.html#core-dependencies">Core Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../license.html#optional-dependencies">Optional Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../license.html#development-dependencies">Development Dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#about-mit-license">About MIT License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#for-commercial-use">For Commercial Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#contributions">Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#attribution">Attribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../license.html#questions">Questions</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DDF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ddf.ddf</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ddf.ddf</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Author: Hadi Cahyadi &lt;cumulus13@gmail.com&gt;</span>
<span class="c1"># Date: 2025-09-26 23:49:31.294806</span>
<span class="c1"># Description:  Enhanched Docker Compose Tools</span>
<span class="c1"># License: MIT</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span> <span class="nn">rich.syntax</span> <span class="kn">import</span> <span class="n">Syntax</span>
<span class="kn">from</span> <span class="nn">rich.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span> <span class="o">==</span> <span class="n">arg</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ðŸž Debug mode enabled&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;LOGGING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;NO_LOGGING&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOGGING&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NO_LOGGING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="n">tprint</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">richcolorlog</span> <span class="kn">import</span> <span class="n">setup_logging</span><span class="p">,</span> <span class="n">print_exception</span> <span class="k">as</span> <span class="n">tprint</span>  <span class="c1"># type: ignore</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logging</span><span class="p">(</span><span class="n">exceptions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PIL&#39;</span><span class="p">,</span> <span class="s1">&#39;PILLOW&#39;</span><span class="p">,</span> <span class="s1">&#39;subprocess&#39;</span><span class="p">,</span> <span class="s1">&#39;watchdog&#39;</span><span class="p">,</span> <span class="s1">&#39;shutil&#39;</span><span class="p">,</span> <span class="s1">&#39;plyer&#39;</span><span class="p">,</span> <span class="s1">&#39;pystray&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DDF&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;PIL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;PILLOW&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;subprocess&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;watchdov&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;shutil&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;plyer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pystray&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.custom_logging</span> <span class="kn">import</span> <span class="n">get_logger</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">custom_logging</span> <span class="kn">import</span> <span class="n">get_logger</span>
        
    <span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;DDF&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">tprint</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">make_colors</span> <span class="kn">import</span> <span class="n">make_colors</span>
    <span class="k">def</span> <span class="nf">tprint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">make_colors</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;lc&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">make_colors</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ly&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">make_colors</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
        <span class="n">tprint</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold #FFFF00]</span><span class="si">{</span><span class="n">message</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">[/][bold red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">redis</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pydebugger.debug</span> <span class="kn">import</span> <span class="n">debug</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> 
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">configset</span> <span class="kn">import</span> <span class="n">configset</span>
<span class="kn">from</span> <span class="nn">rich_argparse</span> <span class="kn">import</span> <span class="n">RichHelpFormatter</span><span class="p">,</span> <span class="n">_lazy_rich</span> <span class="k">as</span> <span class="n">rr</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">rich</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">clipboard</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="c1"># from contextlib import contextmanager</span>
<span class="c1"># import importlib</span>
<span class="kn">import</span> <span class="nn">importlib.util</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">gntplib</span> <span class="kn">import</span> <span class="n">Publisher</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">watchdog.observers</span> <span class="kn">import</span> <span class="n">Observer</span>
<span class="kn">from</span> <span class="nn">watchdog.events</span> <span class="kn">import</span> <span class="n">FileSystemEventHandler</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">_SERVER_MODE_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pystray</span> <span class="kn">import</span> <span class="n">Icon</span><span class="p">,</span> <span class="n">Menu</span><span class="p">,</span> <span class="n">MenuItem</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span>
    <span class="kn">import</span> <span class="nn">plyer</span>
    <span class="n">_SERVER_MODE_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold red]âš ï¸ Server mode requires: pystray, Pillow, plyer. Install with:[/]&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;    pip install pystray Pillow plyer&quot;</span><span class="p">)</span>
    <span class="c1"># sys.exit(1)</span>

<span class="n">CONFIGFILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;ddf.ini&#39;</span><span class="p">)</span>
<span class="n">CONFIG</span> <span class="o">=</span> <span class="n">configset</span><span class="p">(</span><span class="n">CONFIGFILE</span><span class="p">)</span>

<span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_HOST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_HOST&#39;</span><span class="p">]:</span>
        <span class="c1"># If no port is specified, default to 2375 for TCP or 2376 for TLS</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_HOST&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="s1">&#39;2375&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;tls_verify&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;tls_port&#39;</span><span class="p">,</span> <span class="s1">&#39;2376&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;tls_verify&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_TLS_VERIFY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;tls_verify&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;cert_path&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_CERT_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;cert_path&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;api_version&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DOCKER_API_VERSION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;api_version&#39;</span><span class="p">)</span>

<span class="c1"># ================================ #</span>
<span class="c1"># SERVER MODE + TRAY ICON SUPPORT  #</span>
<span class="c1"># ==============================   #</span>
<span class="n">LOCK_FILE</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.ddf_server.lock&#39;</span>

<div class="viewcode-block" id="is_server_running">
<a class="viewcode-back" href="../../api/server.html#ddf.is_server_running">[docs]</a>
<span class="k">def</span> <span class="nf">is_server_running</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if server is actually running by testing socket connection.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    
    <span class="c1"># If socket fails but lock exists, clean up stale lock</span>
    <span class="k">if</span> <span class="n">LOCK_FILE</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">LOCK_FILE</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<span class="n">SERVER_HOST</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span>
<span class="n">SERVER_PORT</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;9876&#39;</span><span class="p">))</span>
<span class="n">SERVER_ACTIVE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_server_running</span><span class="p">()</span>

<span class="n">_imports</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">lazy_import</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lazy import helper with caching.&quot;&quot;&quot;</span>
    <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">attr</span> <span class="k">else</span> <span class="n">module_name</span>
    
    <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_imports</span><span class="p">:</span>
        <span class="c1"># Import the module</span>
        <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">module_name</span><span class="p">:</span>
            <span class="c1"># For dotted module names (e.g., &#39;rich.console&#39;)</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For simple module names (e.g., &#39;json&#39;)</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
        
        <span class="c1"># Get the attribute if specified</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">:</span>
            <span class="n">_imports</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_imports</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
    
    <span class="k">return</span> <span class="n">_imports</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>

<div class="viewcode-block" id="create_emoji_icon">
<a class="viewcode-back" href="../../api/server.html#ddf.create_emoji_icon">[docs]</a>
<span class="k">def</span> <span class="nf">create_emoji_icon</span><span class="p">(</span><span class="n">emoji</span><span class="o">=</span><span class="s2">&quot;ðŸ³&quot;</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">img</span></div>


<div class="viewcode-block" id="notify_user">
<a class="viewcode-back" href="../../api/server.html#ddf.notify_user">[docs]</a>
<span class="k">def</span> <span class="nf">notify_user</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">notify_user</span><span class="p">,</span> <span class="s1">&#39;icon&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">notify_user</span><span class="o">.</span><span class="n">icon</span><span class="p">:</span>
            <span class="n">notify_user</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
        <span class="n">plyer</span><span class="o">.</span><span class="n">notification</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;ddf&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;ddf.png&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;ddf.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Publisher</span><span class="p">(</span><span class="s2">&quot;DDF&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">,</span> <span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="s1">&#39;emergency&#39;</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;critical&#39;</span><span class="p">],</span> <span class="n">icon</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">print_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;Error send notification to Growl !&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="acquire_lock">
<a class="viewcode-back" href="../../api/server.html#ddf.acquire_lock">[docs]</a>
<span class="k">def</span> <span class="nf">acquire_lock</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">LOCK_FILE</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">release_lock</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="release_lock">
<a class="viewcode-back" href="../../api/server.html#ddf.release_lock">[docs]</a>
<span class="k">def</span> <span class="nf">release_lock</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">LOCK_FILE</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">missing_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="send_to_server">
<a class="viewcode-back" href="../../api/server.html#ddf.send_to_server">[docs]</a>
<span class="k">def</span> <span class="nf">send_to_server</span><span class="p">(</span><span class="n">command_dict</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">command_dict</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="validate_service_name">
<a class="viewcode-back" href="../../api/core.html#ddf.validate_service_name">[docs]</a>
<span class="k">def</span> <span class="nf">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate service name to prevent injection attacks.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Service name cannot be empty&quot;</span><span class="p">)</span>
    
    <span class="c1"># Allow alphanumeric, dash, underscore, dot</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-zA-Z0-9._-]+$&#39;</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid service name: </span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">. Only alphanumeric, dash, underscore, and dot allowed.&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Service name too long (max 255 characters)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">service_name</span></div>


<div class="viewcode-block" id="safe_subprocess_run">
<a class="viewcode-back" href="../../api/core.html#ddf.safe_subprocess_run">[docs]</a>
<span class="k">def</span> <span class="nf">safe_subprocess_run</span><span class="p">(</span><span class="n">command_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Safely run subprocess with validation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Command must be a list&quot;</span><span class="p">)</span>
    
    <span class="c1"># Validate command exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">command_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command not found: </span><span class="si">{</span><span class="n">command_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Run with proper error handling</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">command_list</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>  <span class="c1"># 5 min default</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[red]Command timeout exceeded[/]&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Command failed with exit code </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">raise</span></div>


<span class="c1"># @contextmanager</span>
<span class="c1"># def safe_file_open(filepath, mode=&#39;r&#39;, encoding=None):</span>
<span class="c1">#     &quot;&quot;&quot;Context manager for safe file operations with proper error handling.&quot;&quot;&quot;</span>
<span class="c1">#     f = None</span>
<span class="c1">#     try:</span>
<span class="c1">#         f = open(filepath, mode, encoding=encoding)</span>
<span class="c1">#         yield f</span>
<span class="c1">#     except FileNotFoundError:</span>
<span class="c1">#         console.print(f&quot;[red]File not found: {filepath}[/]&quot;)</span>
<span class="c1">#         raise</span>
<span class="c1">#     except PermissionError:</span>
<span class="c1">#         console.print(f&quot;[red]Permission denied: {filepath}[/]&quot;)</span>
<span class="c1">#         raise</span>
<span class="c1">#     except Exception as e:</span>
<span class="c1">#         console.print(f&quot;[red]Error accessing file {filepath}: {e}[/]&quot;)</span>
<span class="c1">#         raise</span>
<span class="c1">#     finally:</span>
<span class="c1">#         if f and not f.closed:</span>
<span class="c1">#             f.close()</span>

<div class="viewcode-block" id="execute_command_in_server">
<a class="viewcode-back" href="../../api/server.html#ddf.execute_command_in_server">[docs]</a>
<span class="k">def</span> <span class="nf">execute_command_in_server</span><span class="p">(</span><span class="n">cmd_dict</span><span class="p">):</span>
    <span class="n">original_argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="n">original_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">original_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cmd_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cwd&quot;</span><span class="p">,</span> <span class="n">original_cwd</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ddf&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmd_dict</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
        <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">captured</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Usage</span><span class="o">.</span><span class="n">usage</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">SystemExit</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">captured</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;âœ…&quot;</span> <span class="ow">in</span> <span class="n">output</span> <span class="ow">or</span> <span class="s2">&quot;success&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Task Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;Command executed successfully.&quot;</span><span class="p">)</span>
            <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Task Completed&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;âŒ&quot;</span> <span class="ow">in</span> <span class="n">output</span> <span class="ow">or</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;An error occurred&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
            <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Server Error&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Server Error&quot;</span><span class="p">,</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">original_cwd</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">original_stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">original_argv</span></div>


<span class="c1"># Cache backend configuration</span>
<div class="viewcode-block" id="CacheBackend">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheBackend">[docs]</a>
<span class="k">class</span> <span class="nc">CacheBackend</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
    <span class="n">PICKLE</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span>
    <span class="n">MEMCACHED</span> <span class="o">=</span> <span class="s2">&quot;memcached&quot;</span>
    <span class="n">MEMCACHED_PICKLE</span> <span class="o">=</span> <span class="s2">&quot;memcached_pickle&quot;</span>
    <span class="n">REDIS</span> <span class="o">=</span> <span class="s2">&quot;redis&quot;</span>
    <span class="n">REDIS_PICKLE</span> <span class="o">=</span> <span class="s2">&quot;redis_pickle&quot;</span></div>


<div class="viewcode-block" id="CacheConfig">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheConfig">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CacheConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cache configuration.&quot;&quot;&quot;</span>
    <span class="n">backend</span><span class="p">:</span> <span class="n">CacheBackend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">REDIS</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">memcached_servers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">redis_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>  <span class="c1"># Changed from hardcoded IP</span>
    <span class="n">redis_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6379</span>
    <span class="n">redis_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Changed from hardcoded password</span>
    <span class="n">redis_db</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pickle_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/tmp/docker_cache&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;C:\TEMP\docker_cache&quot;</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memcached_servers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memcached_servers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">11211</span><span class="p">)]</span>  <span class="c1"># Changed</span>
        
        <span class="c1"># Read from config or environment</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;backend&#39;</span><span class="p">,</span> <span class="s1">&#39;redis&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;ttl&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;ttl&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span>
            
            <span class="c1"># Prioritize environment variables for security</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_HOST&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_host&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_port&#39;</span><span class="p">,</span> <span class="s1">&#39;6379&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_PASSWORD&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_password&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redis_db</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;REDIS_DB&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;redis_db&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span>
            
            <span class="c1"># Parse memcached servers</span>
            <span class="n">memcached_cfg</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;cache&#39;</span><span class="p">,</span> <span class="s1">&#39;memcached_servers&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost:11211&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memcached_servers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">11211</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">memcached_cfg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memcached_servers</span> <span class="o">=</span> <span class="p">[(</span><span class="n">host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">))</span> <span class="k">for</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">memcached_servers</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading cache config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<span class="n">CACHE_CONFIG</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">()</span>

<div class="viewcode-block" id="write_hash">
<a class="viewcode-back" href="../../api/core.html#ddf.write_hash">[docs]</a>
<span class="k">def</span> <span class="nf">write_hash</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">algo</span><span class="o">=</span><span class="s2">&quot;sha256&quot;</span><span class="p">):</span>
    <span class="n">hash_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">file_bytes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_hash -&gt; filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1">#h = getattr(hashlib, algo)()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1">#while chunk := f.read(8192):</span>
            <span class="c1">#h.update(chunk)</span>
        <span class="n">file_bytes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">hash_code</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">file_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_hash -&gt; has_code: </span><span class="si">{</span><span class="n">hash_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_hash -&gt; dir_name: </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">file_hash</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hash_code</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_hash -&gt; file_hash: </span><span class="si">{</span><span class="n">file_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">check_file_hash</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">algo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)]))</span>
    
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;write_hash -&gt; check_file_hash: </span><span class="si">{</span><span class="n">check_file_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">check_file_hash</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">fe</span> <span class="ow">in</span> <span class="n">check_file_hash</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_hash</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">hash_code</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">hash_code</span><span class="p">,</span> <span class="n">file_hash</span><span class="p">,</span> <span class="n">file_bytes</span></div>


<div class="viewcode-block" id="CacheManager">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager">[docs]</a>
<span class="k">class</span> <span class="nc">CacheManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unified cache manager supporting multiple backends.&quot;&quot;&quot;</span>
    
    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_clients</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    
<div class="viewcode-block" id="CacheManager.__new__">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.__new__">[docs]</a>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>  <span class="c1"># Thread-safe check</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span></div>

    
<div class="viewcode-block" id="CacheManager.__init__">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span> <span class="o">=</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">ttl</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">)</span></div>


<div class="viewcode-block" id="CacheManager.cleanup">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.cleanup">[docs]</a>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup cache connections on exit.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">backend</span><span class="p">,</span> <span class="n">client</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">):</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s1">&#39;disconnect&#39;</span><span class="p">):</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing cache client </span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="CacheManager._get_client">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager._get_client">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or create cache client with proper error handling.&quot;&quot;&quot;</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;backend: </span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span>
        
        <span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">or</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;memcached_pickle&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">pymemcache.client.base</span> <span class="kn">import</span> <span class="n">Client</span>
                    <span class="kn">from</span> <span class="nn">pymemcache</span> <span class="kn">import</span> <span class="n">serde</span>
                    
                    <span class="n">server</span> <span class="o">=</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">memcached_servers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;memcached_pickle&#39;</span><span class="p">:</span>
                        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span>
                            <span class="n">server</span><span class="p">,</span>
                            <span class="n">serializer</span><span class="o">=</span><span class="n">serde</span><span class="o">.</span><span class="n">pickle_serde</span><span class="p">,</span>
                            <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span>
                            <span class="n">server</span><span class="p">,</span>
                            <span class="n">serializer</span><span class="o">=</span><span class="n">serde</span><span class="o">.</span><span class="n">python_memcache_serializer</span><span class="p">,</span>
                            <span class="n">deserializer</span><span class="o">=</span><span class="n">serde</span><span class="o">.</span><span class="n">python_memcache_deserializer</span><span class="p">,</span>
                            <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span>
                        <span class="p">)</span>
                    
                    <span class="n">client</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>  <span class="c1"># Test connection</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim green]âœ“ Memcached connected: </span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[yellow]Warning: pymemcache not installed, falling back to pickle[/]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">PICKLE</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>  <span class="c1"># Recursive call with new backend</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Warning: Memcached not available (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">), falling back to pickle[/]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">PICKLE</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            
            <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">or</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;redis_pickle&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">redis</span> <span class="o">=</span> <span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">)</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
                        <span class="n">host</span><span class="o">=</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_host</span><span class="p">,</span>
                        <span class="n">port</span><span class="o">=</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_port</span><span class="p">,</span>
                        <span class="n">password</span><span class="o">=</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_password</span> <span class="k">if</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_password</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">db</span><span class="o">=</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_db</span><span class="p">,</span>
                        <span class="n">decode_responses</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">socket_connect_timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">socket_timeout</span><span class="o">=</span><span class="mi">2</span>  <span class="c1"># Add timeout</span>
                    <span class="p">)</span>
                    <span class="n">client</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim green]âœ“ Redis connected: </span><span class="si">{</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">redis_host</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Warning: Redis not available (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">), falling back to pickle[/]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">PICKLE</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            
            <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Path</span><span class="p">(</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;dir&#39;</span><span class="p">:</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="p">}</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim green]âœ“ Using pickle cache: </span><span class="si">{</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Failed to create pickle cache directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">NONE</span>
                    <span class="k">return</span> <span class="kc">None</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">backend</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span>
            <span class="k">return</span> <span class="n">client</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Critical error initializing cache backend: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">CacheBackend</span><span class="o">.</span><span class="n">NONE</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="CacheManager._serialize">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager._serialize">[docs]</a>
    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize data based on backend.&quot;&quot;&quot;</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>
        
        <span class="c1"># For pymemcache with serializers, return data as-is (handled by client)</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;memcached&#39;</span><span class="p">,</span> <span class="s1">&#39;memcached_pickle&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">data</span>
        
        <span class="k">if</span> <span class="s1">&#39;pickle&#39;</span> <span class="ow">in</span> <span class="n">backend</span> <span class="ow">or</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
            <span class="n">pickle</span> <span class="o">=</span> <span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;pickle&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="CacheManager._deserialize">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager._deserialize">[docs]</a>
    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deserialize data based on backend.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>
        
        <span class="c1"># For pymemcache with serializers, data already deserialized</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;memcached&#39;</span><span class="p">,</span> <span class="s1">&#39;memcached_pickle&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">data</span>
        
        <span class="k">if</span> <span class="s1">&#39;pickle&#39;</span> <span class="ow">in</span> <span class="n">backend</span> <span class="ow">or</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
            <span class="n">pickle</span> <span class="o">=</span> <span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;pickle&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">lazy_import</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="CacheManager._get_pickle_path">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager._get_pickle_path">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_pickle_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get pickle file path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.pkl&quot;</span></div>


<div class="viewcode-block" id="CacheManager._register_cache_key">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager._register_cache_key">[docs]</a>
    <span class="k">def</span> <span class="nf">_register_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a cache key for pattern-based invalidation (memcached only).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Only needed for memcached</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
        <span class="n">registry_key</span> <span class="o">=</span> <span class="s2">&quot;__cache_keys__&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get current set of keys</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">registry_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Deserialize using pickle (since we use memcached_pickle serde)</span>
                <span class="n">key_set</span> <span class="o">=</span> <span class="n">current</span>  <span class="c1"># pymemcache with pickle serde returns Python object directly</span>

            <span class="c1"># Add new key</span>
            <span class="n">key_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="c1"># Store back with long TTL (e.g., 1 week)</span>
            <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">registry_key</span><span class="p">,</span> <span class="n">key_set</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">604800</span><span class="p">)</span>  <span class="c1"># 7 days</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim yellow]Failed to register cache key: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span></div>

            <span class="c1"># Non-fatal: continue without registry</span>
    
<div class="viewcode-block" id="CacheManager.get">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get value from cache.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>
            
            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pickle_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="c1"># Check TTL</span>
                    
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;time.time(): </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;path.stat().st_mtime: </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;self.ttl: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ttl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span><span class="p">:</span>
                        <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                        <span class="k">return</span> <span class="kc">None</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
                <span class="k">return</span> <span class="kc">None</span>
            
            <span class="k">elif</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="c1"># pymemcache returns None if key not found</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>  <span class="c1"># Already deserialized by pymemcache</span>
            
            <span class="k">elif</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="kc">None</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">print_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;Cache get error&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

        
<div class="viewcode-block" id="CacheManager.set">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.set">[docs]</a>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">ttl</span> <span class="o">=</span> <span class="n">ttl</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttl</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ttl: </span><span class="si">{</span><span class="n">ttl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pickle_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="c1"># Register key in __cache_keys__</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_register_cache_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c1"># pymemcache handles serialization automatically</span>
                <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span> <span class="k">if</span> <span class="n">ttl</span> <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">ttl</span> <span class="k">else</span> <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Cache set error:[/] [white on red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>            
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="CacheManager.delete">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.delete">[docs]</a>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pickle_path</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="c1"># Also remove from registry</span>
                <span class="n">registry_key</span> <span class="o">=</span> <span class="s2">&quot;__cache_keys__&quot;</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">registry_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">key_set</span> <span class="o">=</span> <span class="n">current</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_set</span><span class="p">:</span>
                        <span class="n">key_set</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                        <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">registry_key</span><span class="p">,</span> <span class="n">key_set</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">604800</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Cache delete error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="CacheManager.invalidate_pattern">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.invalidate_pattern">[docs]</a>
    <span class="k">def</span> <span class="nf">invalidate_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">*.pkl&quot;</span><span class="p">):</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">count</span>

            <span class="k">elif</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span>

            <span class="k">elif</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="c1"># Use manual key registry</span>
                <span class="n">registry_key</span> <span class="o">=</span> <span class="s2">&quot;__cache_keys__&quot;</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">registry_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>

                <span class="n">key_set</span> <span class="o">=</span> <span class="n">current</span>  <span class="c1"># already deserialized by pymemcache pickle serde</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                    <span class="n">key_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

                <span class="c1"># Find keys matching pattern</span>
                <span class="n">to_delete</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key_set</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">)}</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">to_delete</span><span class="p">:</span>
                    <span class="k">return</span> <span class="mi">0</span>

                <span class="c1"># Delete each key</span>
                <span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                        <span class="n">deleted</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">key_set</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

                <span class="c1"># Update registry</span>
                <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">registry_key</span><span class="p">,</span> <span class="n">key_set</span><span class="p">,</span> <span class="n">expire</span><span class="o">=</span><span class="mi">604800</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">deleted</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Cache invalidate error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="CacheManager.flush_all">
<a class="viewcode-back" href="../../api/cache.html#ddf.CacheManager.flush_all">[docs]</a>
    <span class="k">def</span> <span class="nf">flush_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush all cache (useful for memcached).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span>
            
            <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">pickle_dir</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.pkl&quot;</span><span class="p">):</span>
                    <span class="n">path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[green]Cleared </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> pickle cache files[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            
            <span class="k">elif</span> <span class="s1">&#39;memcached&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">flush_all</span><span class="p">()</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]Memcached flushed[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            
            <span class="k">elif</span> <span class="s1">&#39;redis&#39;</span> <span class="ow">in</span> <span class="n">backend</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">flushdb</span><span class="p">()</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[green]Redis DB flushed[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Cache flush error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>
</div>


<span class="c1"># Global cache manager</span>
<span class="n">CACHE</span> <span class="o">=</span> <span class="n">CacheManager</span><span class="p">()</span>

<div class="viewcode-block" id="get_hash_from_file">
<a class="viewcode-back" href="../../api/core.html#ddf.get_hash_from_file">[docs]</a>
<span class="k">def</span> <span class="nf">get_hash_from_file</span><span class="p">():</span>
    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">code_hash</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>    
    <span class="n">check_file_hash</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.sha256&quot;</span><span class="p">),</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)]))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;check_file_hash: </span><span class="si">{</span><span class="n">check_file_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">check_file_hash</span><span class="p">:</span>
        <span class="n">code_hash</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">check_file_hash</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.sha256&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">notice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;code_hash: </span><span class="si">{</span><span class="n">code_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">code_hash</span></div>

    

<div class="viewcode-block" id="compare_hash">
<a class="viewcode-back" href="../../api/core.html#ddf.compare_hash">[docs]</a>
<span class="k">def</span> <span class="nf">compare_hash</span><span class="p">():</span>
    <span class="n">cache_hash</span> <span class="o">=</span> <span class="n">CACHE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;yaml:hash&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cache_hash: </span><span class="si">{</span><span class="n">cache_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">code_hash</span> <span class="o">=</span> <span class="n">get_hash_from_file</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_hash</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">code_hash</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">code_hash</span><span class="p">,</span> <span class="n">cache_hash</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">code_hash</span><span class="p">,</span> <span class="n">cache_hash</span><span class="p">,</span> <span class="n">cache_hash</span> <span class="o">==</span> <span class="n">code_hash</span></div>

    
<div class="viewcode-block" id="cache_with_invalidation">
<a class="viewcode-back" href="../../api/core.html#ddf.cache_with_invalidation">[docs]</a>
<span class="k">def</span> <span class="nf">cache_with_invalidation</span><span class="p">(</span>
    <span class="n">ttl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">invalidate_on</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">validation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator for caching with smart invalidation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        ttl: Time to live in seconds</span>
<span class="sd">        key_prefix: Prefix for cache key</span>
<span class="sd">        invalidate_on: List of patterns to invalidate</span>
<span class="sd">        validation: Function to check if backend changed (returns hash/version)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">CACHE_CONFIG</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="c1"># Generate cache key</span>
            <span class="n">key_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">key_prefix</span> <span class="ow">or</span> <span class="n">get_hash_from_file</span><span class="p">()</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
            
            <span class="c1"># Add args to key</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
                    <span class="n">key_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            
            <span class="c1"># Add kwargs to key</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
                    <span class="n">key_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="n">cache_key</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key_parts</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;validation: </span><span class="si">{</span><span class="n">validation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_status</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;validation: </span><span class="si">{</span><span class="n">validation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">current_hash</span><span class="p">,</span> <span class="n">cache_hash</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">validation</span><span class="p">()</span>
                    <span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_status: </span><span class="si">{</span><span class="n">_status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
                        <span class="n">CACHE</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">)</span>
                        <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">,</span> <span class="n">current_hash</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Cache invalidated: docker-compose file changed[/]&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">validation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cache_hash</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">,</span> <span class="n">current_hash</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validation</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">validation</span><span class="p">:</span>
                    <span class="n">current_hash</span><span class="p">,</span> <span class="n">cache_hash</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">compare_hash</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
                        <span class="n">CACHE</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">)</span>
                        <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">,</span> <span class="n">current_hash</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Cache invalidated: docker-compose file changed[/]&quot;</span><span class="p">)</span>                    
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Warning: validation failed (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">), skipping version check[/]&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>
            
            <span class="c1"># Try to get from cache</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cache_key: </span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cached</span> <span class="o">=</span> <span class="n">CACHE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">alert</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cached: </span><span class="si">{</span><span class="n">cached</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">_status</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim green]Cache hit: </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cached</span>
            
            <span class="c1"># Execute function</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim yellow]Cache miss: </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ttl: </span><span class="si">{</span><span class="n">ttl</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">notice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># Store in cache</span>
            <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="n">ttl</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span></div>


<div class="viewcode-block" id="DDFServer">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer">[docs]</a>
<span class="k">class</span> <span class="nc">DDFServer</span><span class="p">:</span>
<div class="viewcode-block" id="DDFServer.__init__">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_SERVER_MODE_AVAILABLE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;âš ï¸ Server mode requires: pip install pystray Pillow plyer&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DDFServer.health_check">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.health_check">[docs]</a>
    <span class="k">def</span> <span class="nf">health_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform health check on server components.&quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;server_running&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">,</span>
            <span class="s1">&#39;lock_file_exists&#39;</span><span class="p">:</span> <span class="n">LOCK_FILE</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
            <span class="s1">&#39;port_available&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_port_available</span><span class="p">(),</span>
            <span class="s1">&#39;cache_available&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cache</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="DDFServer._check_port_available">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer._check_port_available">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_port_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="DDFServer._check_cache">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer._check_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_key</span> <span class="o">=</span> <span class="s1">&#39;__health_check__&#39;</span>
            <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">test_key</span><span class="p">,</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">CACHE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">test_key</span><span class="p">)</span>
            <span class="n">CACHE</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">test_key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="s1">&#39;ok&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="DDFServer.handle_client">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.handle_client">[docs]</a>
    <span class="k">def</span> <span class="nf">handle_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="c1"># Handle health check</span>
            <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;health_check&quot;</span><span class="p">:</span>
                <span class="n">health</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_check</span><span class="p">()</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">health</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Normal command execution</span>
                <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">execute_command_in_server</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;{&quot;status&quot;:&quot;accepted&quot;}&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error handling client: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="DDFServer.run_server">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.run_server">[docs]</a>
    <span class="k">def</span> <span class="nf">run_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">acquire_lock</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[red]Failed to bind server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">release_lock</span><span class="p">()</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Ensure socket closed</span>
            <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">notify_user</span><span class="p">(</span><span class="s2">&quot;Server Started&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Listening on </span><span class="si">{</span><span class="n">SERVER_HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">SERVER_PORT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_client</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">),</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>  <span class="c1"># Only log if not shutting down</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]Server accept error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># Always close socket</span>
            <span class="n">release_lock</span><span class="p">()</span></div>


<div class="viewcode-block" id="DDFServer.setup_tray">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.setup_tray">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_tray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span>
                <span class="n">MenuItem</span><span class="p">(</span><span class="s2">&quot;ðŸŸ¢ Start Server&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_server</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span>
                <span class="n">MenuItem</span><span class="p">(</span><span class="s2">&quot;ðŸ”´ Stop Server&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="n">release_lock</span><span class="p">()),</span>
                <span class="n">MenuItem</span><span class="p">(</span><span class="s2">&quot;ðŸšª Quit&quot;</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">quit_app</span><span class="p">())</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="n">Icon</span><span class="p">(</span><span class="s2">&quot;ddf&quot;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">create_emoji_icon</span><span class="p">(),</span> <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;DDF Server&quot;</span><span class="p">)</span>
            <span class="n">notify_user</span><span class="o">.</span><span class="n">icon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_server</span><span class="p">()</span></div>


<div class="viewcode-block" id="DDFServer.quit_app">
<a class="viewcode-back" href="../../api/server.html#ddf.DDFServer.quit_app">[docs]</a>
    <span class="k">def</span> <span class="nf">quit_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">release_lock</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="BackupManager">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager">[docs]</a>
<span class="k">class</span> <span class="nc">BackupManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles backup operations for files and directory management.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="BackupManager.get_backup_dir">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager.get_backup_dir">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_backup_dir</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or create backup directory.&quot;&quot;&quot;</span>
        <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;backup&#39;</span><span class="p">,</span> <span class="s1">&#39;directory&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;backups&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backup_dir</span></div>

    
<div class="viewcode-block" id="BackupManager.create_backup">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager.create_backup">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_backup</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a backup of the file before editing.</span>
<span class="sd">        Returns the backup file path or None if backup failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]File does not exist, cannot create backup: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">get_backup_dir</span><span class="p">()</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">backup_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">operation_type</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.backup&quot;</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">backup_filename</span><span class="p">)</span>
            
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ’¾ [cyan]Backup created:[/] </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">backup_path</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Failed to create backup:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="BackupManager.restore_from_backup">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager.restore_from_backup">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">restore_from_backup</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">original_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore file from backup.</span>
<span class="sd">        Returns True if successful, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Backup file does not exist:[/] </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
                
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">original_path</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]File restored from backup:[/] </span><span class="si">{</span><span class="n">original_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Failed to restore from backup:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="BackupManager.list_backups">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager.list_backups">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_backups</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List available backups, optionally filtered by file.&quot;&quot;&quot;</span>
        <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">get_backup_dir</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;ðŸ“ [yellow]No backup directory found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
            
        <span class="n">backups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">backup_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">backup_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.backup&#39;</span><span class="p">):</span>
                <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">backup_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>
                    <span class="n">original_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">original_filename</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="n">backups</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">backup_file</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)))</span>
        
        <span class="c1"># Sort by modification time (newest first)</span>
        <span class="n">backups</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">backups</span></div>

    
<div class="viewcode-block" id="BackupManager.prompt_restore_backup">
<a class="viewcode-back" href="../../api/backup.html#ddf.BackupManager.prompt_restore_backup">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">prompt_restore_backup</span><span class="p">(</span><span class="n">original_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prompt user to restore from available backups.</span>
<span class="sd">        Returns True if restoration was performed, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">backups</span> <span class="o">=</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">list_backups</span><span class="p">(</span><span class="n">original_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">backups</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;ðŸ“ [yellow]No backups available for this file.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
            
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“‹ [bold cyan]Available backups for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">original_path</span><span class="p">)</span><span class="si">}</span><span class="s2">:[/]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">backup_name</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">,</span> <span class="n">mtime</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">backups</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># Show only last 5</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">mtime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. [yellow]</span><span class="si">{</span><span class="n">backup_name</span><span class="si">}</span><span class="s2">[/] ([cyan]</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">[/])&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ”„ [bold yellow]Would you like to restore from a backup? (1-5/n): [/]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">choice</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
                
            <span class="n">backup_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">backup_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">backups</span><span class="p">[:</span><span class="mi">5</span><span class="p">]):</span>
                <span class="n">selected_backup</span> <span class="o">=</span> <span class="n">backups</span><span class="p">[</span><span class="n">backup_index</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">restore_from_backup</span><span class="p">(</span><span class="n">selected_backup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">original_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid backup selection.[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid input or operation cancelled.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>
</div>


<span class="k">class</span> <span class="nc">CustomRichHelpFormatter</span><span class="p">(</span><span class="n">RichHelpFormatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom RichHelpFormatter with modified styles.&quot;&quot;&quot;</span>

    <span class="n">styles</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">rr</span><span class="o">.</span><span class="n">StyleType</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;argparse.args&quot;</span><span class="p">:</span> <span class="s2">&quot;bold #FFFF00&quot;</span><span class="p">,</span>  <span class="c1"># Changed from cyan</span>
        <span class="s2">&quot;argparse.groups&quot;</span><span class="p">:</span> <span class="s2">&quot;#AA55FF&quot;</span><span class="p">,</span>   <span class="c1"># Changed from dark_orange</span>
        <span class="s2">&quot;argparse.help&quot;</span><span class="p">:</span> <span class="s2">&quot;bold #00FFFF&quot;</span><span class="p">,</span>    <span class="c1"># Changed from default</span>
        <span class="s2">&quot;argparse.metavar&quot;</span><span class="p">:</span> <span class="s2">&quot;bold #FF00FF&quot;</span><span class="p">,</span> <span class="c1"># Changed from dark_cyan</span>
        <span class="s2">&quot;argparse.syntax&quot;</span><span class="p">:</span> <span class="s2">&quot;underline&quot;</span><span class="p">,</span> <span class="c1"># Changed from bold</span>
        <span class="s2">&quot;argparse.text&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>   <span class="c1"># Changed from default</span>
        <span class="s2">&quot;argparse.prog&quot;</span><span class="p">:</span> <span class="s2">&quot;bold #00AAFF italic&quot;</span><span class="p">,</span>     <span class="c1"># Changed from grey50</span>
        <span class="s2">&quot;argparse.default&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="c1"># Changed from italic</span>
    <span class="p">}</span>

<div class="viewcode-block" id="DDF">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF">[docs]</a>
<span class="k">class</span> <span class="nc">DDF</span><span class="p">:</span>

    <span class="n">_file_cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">THEME</span> <span class="o">=</span> <span class="s2">&quot;fruity&quot;</span>

<div class="viewcode-block" id="DDF.open_file">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.open_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@cache_with_invalidation</span><span class="p">(</span><span class="n">validation</span> <span class="o">=</span> <span class="n">compare_hash</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;open file calling ...&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file_path: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">notice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file_path: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not readable.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is empty.&quot;</span><span class="p">)</span>

        <span class="n">file_hash</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">file_bytes</span> <span class="o">=</span> <span class="n">write_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;yaml:hash&quot;</span><span class="p">,</span> <span class="n">file_hash</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is not a valid YAML file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> has invalid encoding: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ The file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> is empty or not a valid YAML mapping.&quot;</span><span class="p">)</span>

        <span class="n">CACHE</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;open_file&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span></div>


<div class="viewcode-block" id="DDF.find_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.find_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">find_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a service in the YAML content.</span>
<span class="sd">        Supports pattern matching and substring search.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c1"># Support the pattern/wildcard and substring</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">services</span>
            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">svc</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service pattern &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">matched</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">matched</span></div>

    
<div class="viewcode-block" id="DDF.show_service_detail">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.show_service_detail">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show_service_detail</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the full configuration for a given service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">find_service</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">service_val</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">matched</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ”§ [bold cyan]Configuration for service &#39;</span><span class="si">{</span><span class="n">matched</span><span class="si">}</span><span class="s2">&#39;:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="n">matched</span><span class="p">:</span> <span class="n">service_val</span><span class="p">},</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">line_numbers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
                <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">svc</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">service_val</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ”§ [bold cyan]Configuration for service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="n">svc</span><span class="p">:</span> <span class="n">service_val</span><span class="p">},</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">,</span> <span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span></div>

            
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_service_ports</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="p">):</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c1"># debug(services = services)</span>
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service_val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39; is not a dictionary or has no ports defined.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No ports found for service:[/] </span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸš© [bold cyan]Ports for service &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39;:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â€¢ [green]</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="DDF.find_duplicate_port">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.find_duplicate_port">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">find_duplicate_port</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">target_service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;âŒ Invalid YAML content.&quot;</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;ðŸ” [bold #FFFF00]Scanning for duplicate ports...</span><span class="se">\n</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen_host_ports</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># skip jika value bukan dict</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">):</span>
                <span class="n">parsed_ports</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
                    <span class="n">hp</span><span class="p">,</span> <span class="n">cp</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">hp_proto</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hp</span><span class="si">}</span><span class="s2">/tcp&quot;</span> <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hp</span> <span class="ow">and</span> <span class="s1">&#39;/udp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cp</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hp</span><span class="si">}</span><span class="s2">/udp&quot;</span> <span class="k">if</span> <span class="s1">&#39;/udp&#39;</span> <span class="ow">in</span> <span class="n">cp</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hp</span><span class="si">}</span><span class="s2">/tcp&quot;</span>
                    <span class="n">cp_proto</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">cp</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cp</span><span class="si">}</span><span class="s2">/tcp&quot;</span>
                    <span class="n">parsed_ports</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hp_proto</span><span class="p">,</span> <span class="n">cp_proto</span><span class="p">))</span>
                
                <span class="k">for</span> <span class="n">host_port</span><span class="p">,</span> <span class="n">container_port</span> <span class="ow">in</span> <span class="n">parsed_ports</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">host_port</span> <span class="ow">in</span> <span class="n">seen_host_ports</span><span class="p">:</span>
                        <span class="n">existing</span> <span class="o">=</span> <span class="n">seen_host_ports</span><span class="p">[</span><span class="n">host_port</span><span class="p">]</span>
                        <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">/ports/</span><span class="si">{</span><span class="n">host_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">existing</span><span class="si">}</span><span class="s2">/ports/</span><span class="si">{</span><span class="n">host_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">host_port</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">seen_host_ports</span><span class="p">[</span><span class="n">host_port</span><span class="p">]</span> <span class="o">=</span> <span class="n">service</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="n">s1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port1</span><span class="p">,</span> <span class="n">protocol1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">s2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">port2</span><span class="p">,</span> <span class="n">protocol2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">target_service</span> <span class="ow">and</span> <span class="n">target_service</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span>
                <span class="s2">&quot;âŒ &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[bold #00FFFF]</span><span class="si">{</span><span class="n">s1</span><span class="si">}</span><span class="s2">[/]/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[white on #0000FF]</span><span class="si">{</span><span class="n">port1</span><span class="si">}</span><span class="s2">[/]/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[black on #55FF00]</span><span class="si">{</span><span class="n">protocol1</span><span class="si">}</span><span class="s2">[/] &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[bold #FFAA00]--&gt;[/] &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[bold #00FFFF]</span><span class="si">{</span><span class="n">s2</span><span class="si">}</span><span class="s2">[/]/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[white on #5350000]</span><span class="si">{</span><span class="n">port2</span><span class="si">}</span><span class="s2">[/]/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;[black on #55FF00]</span><span class="si">{</span><span class="n">protocol2</span><span class="si">}</span><span class="s2">[/] &quot;</span>
            <span class="p">)</span></div>

            
<div class="viewcode-block" id="DDF.find_port">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.find_port">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">find_port</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">found_any</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">output_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compact_lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">matched_ports</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">p1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">port</span> <span class="ow">or</span> <span class="n">p2</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">port</span><span class="p">:</span>
                        <span class="n">matched_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[white on #550000]</span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s2">[/]:[white on #550000]</span><span class="si">{</span><span class="n">p2</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                        <span class="c1"># matched_ports.append(f&quot;{p1}:{p2}&quot;)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="n">matched_ports</span><span class="p">:</span>
                <span class="n">found_any</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Format default (lama): tampilkan semua port</span>
                <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- [bold #FFFF00]</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">[/]:&quot;</span><span class="p">)</span>
                <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;  ports:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/udp&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[bold #FF00FF]/udp[/]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/tcp&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[bold #FF00FF]/tcp[/]&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">p1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">port</span> <span class="ow">or</span> <span class="n">p2</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">port</span><span class="p">:</span>
                            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - [white on #550000]</span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s2">[/]:[white on #550000]</span><span class="si">{</span><span class="n">p2</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># output_lines.append(f&quot;    - {p}&quot;)</span>
                            <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - [#00FFFF]</span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s2">[/]:[#00FFFF]</span><span class="si">{</span><span class="n">p2</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="c1"># Format compact: hanya port yang cocok</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">ports_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">matched_ports</span><span class="p">])</span>
                <span class="n">compact_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- [bold #FFFF00]</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">[/]: ports: [</span><span class="si">{</span><span class="n">ports_str</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="sa">f</span><span class="s1">&#39; image: [#00FFFF]</span><span class="si">{</span><span class="n">img</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">found_any</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold #00FFFF]Found service using port[/] [bold #FFAA00]</span><span class="si">{}</span><span class="s2">[/]:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">compact</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">compact_lines</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output_lines</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ‘ [black in #FFFF00]No service found with port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>        </div>

            
<div class="viewcode-block" id="DDF.check_duplicate_port">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.check_duplicate_port">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">check_duplicate_port</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether a particular port is duplicate among all services.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
                <span class="c1"># Support format host:container or just port</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="c1"># if port in [x.strip() for x in parts]:</span>
                <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">service</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [#FF00FF]Port[/] [bold #FFFF00]</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">[/] [#FF00FF]is DUPLICATE in these services:[/]&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">svc</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - [bold cyan]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/]: [yellow]</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">svc</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">found</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸš© [bold #00FFFF]Port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2"> only found in service:[/] [bold #FFAA00]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/] ([yellow]</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">[/])&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [bold #FF007F]Port[/] [#FFFF00]</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">[/] [bold #FF007F]not found in any service.[/]&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">found</span></div>

            
<div class="viewcode-block" id="DDF.list_service_devices">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_service_devices">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_service_devices</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">svc</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Support the pattern/wildcard and substring</span>
            <span class="k">if</span> <span class="n">service</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># debug(value = value)</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;devices&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold cyan]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">:[/]&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  devices:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">dev</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [bold #FFAA00]- </span><span class="si">{</span><span class="n">de</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">[/]: [bold #00AAFF]</span><span class="si">{</span><span class="n">de</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">[/]&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">de</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;    [bold #FFAA00]- </span><span class="si">{</span><span class="n">dev</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]No devices found for service pattern:[/] </span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [yellow]No devices found in any service.[/]&quot;</span><span class="p">)</span></div>

                
<div class="viewcode-block" id="DDF.list_service_volumes">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_service_volumes">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_service_volumes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all volumes for a given service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">svc</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">service</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">volumes</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">volumes</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ”§ [bold cyan]Volumes for service[/] [#FFFF00]&#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;[/]:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[white on #5500FF italic underline]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/]:&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  volumes:&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
                    <span class="n">vo</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - [bold #00AAFF]</span><span class="si">{</span><span class="n">vo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">[/]: [bold #FFAA00]</span><span class="si">{</span><span class="n">vo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">[/]&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vo</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;    - [bold #00AAFF]</span><span class="si">{</span><span class="n">vol</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]No volumes found for service pattern:[/] </span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [yellow]No volumes found in any service.[/]&quot;</span><span class="p">)</span></div>

                
<div class="viewcode-block" id="DDF.list_volumes">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_volumes">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_volumes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volumes&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">volumes</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ no [white on red]volumes section ![/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸª£ [bold #AA55FF]VOLUMES[/]:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - ðŸ¥¡ [bold #00FFFF]</span><span class="si">{</span><span class="n">vol</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">()</span>
        
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
            <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">svc</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">service</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">service_volumes</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">service_volumes</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ch</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">svc</span><span class="p">:</span> <span class="n">ch</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸŸ [bold #FF557F]Found[/] </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="si">}</span><span class="s2"> [bold #AAAA7F]</span><span class="si">{</span><span class="s1">&#39;service&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;services&#39;</span><span class="w"> </span><span class="si">}</span><span class="s2">[/] for [bold #AAFFFF]&#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39;[/] in [bold #AA55FF]VOLUMES[/]:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ffo</span><span class="p">,</span> <span class="n">vo</span> <span class="ow">in</span> <span class="n">fo</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   [#FFAA00]*[/] [bold #FFAAFF]</span><span class="si">{</span><span class="n">ffo</span><span class="si">}</span><span class="s2">[/]:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ffo</span> <span class="ow">in</span> <span class="n">vo</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">ffo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      - [bold #00FFFF]</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">[/]:[bold #FFFF00]</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DDF.list_hostnames">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_hostnames">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_hostnames</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the hostname(s) for a given service, or all hostnames if no service is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">svc</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">services</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">service</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hostname</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># lines.append(f&quot;[bold cyan]{svc}:[/]  hostname: [bold #00AAFF]{hostname}[/]&quot;)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;[bold #FFFF00]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;[bold #00AAFF]</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]No hostname found for service pattern:[/] [white on blue]</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [yellow]No hostnames found in any service.[/]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold #00FFFF]Hostnames found:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">show_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_edge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pad_edge</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># table = Table(box=box.SQUARE, show_lines = True)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="n">justify</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">justify</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="n">justify</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;[#FF55FF]hostname:[/]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="DDF.list_service_ports">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_service_ports">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_service_ports</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">service</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all ports for a given service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_val</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[yellow]No ports found for service:[/] </span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“Œ [bold cyan]Ports for service &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39;:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - [green]</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.get_list_service_names">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.get_list_service_names">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@cache_with_invalidation</span><span class="p">(</span><span class="n">validation</span> <span class="o">=</span> <span class="n">compare_hash</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_list_service_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span>  <span class="nb">filter</span><span class="p">:</span>  <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No services found in the YAML file.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">service_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">:</span>
                <span class="c1"># Try regex</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">filtered</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">service_names</span> <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">svc</span><span class="p">)])</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c1"># Wildcard (fnmatch)</span>
                <span class="kn">import</span> <span class="nn">fnmatch</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">service_names</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">f</span><span class="p">)])</span>
                <span class="c1"># Substring</span>
                <span class="n">filtered</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">service_names</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">])</span>
            <span class="n">service_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">notice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;service_names: </span><span class="si">{</span><span class="n">service_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">service_names</span></div>

            
<div class="viewcode-block" id="DDF.list_service_names">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.list_service_names">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_service_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            filter support regex, wildchar, or substring matching.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#logger.notice(f&quot;cls: {cls}&quot;)</span>
        <span class="n">service_names</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_list_service_names</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">service_names</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ [bold #FFFF00]Available service names:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">service_names</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - [bold #00FFFF]</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No matching services found.[/]&quot;</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="DDF.get_dockerfile">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.get_dockerfile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dockerfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">show_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Dockerfile path for a given service name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">root_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;root_path&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;root_path&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;root_path&#39;</span><span class="p">))</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS&quot;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;c:\PROJECTS&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span><span class="p">)</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">check1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">service_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="n">check2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">service_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">services</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        
        <span class="k">if</span> <span class="n">check1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">show_all</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ [bold #FFFF00]There is[/] [bold #00FFFF]</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span><span class="si">}</span><span class="s2">[/] [bold #FFFF00]services found ![/]&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">check2</span><span class="p">):</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [bold #AAAAFF]</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">))))</span><span class="si">}</span><span class="s2">.[/] [#bold #FFAA00]</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">check1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ [bold #FFFF00]There is[/] [bold #00FFFF]</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span><span class="si">}</span><span class="s2">[/] [bold #FFFF00]services found ![/]&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">check2</span><span class="p">):</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    [bold #AAAAFF]</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">))))</span><span class="si">}</span><span class="s2">.[/] [#bold #FFAA00]</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ“š [white on blue]Which one to edit: &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">q</span> <span class="ow">and</span> <span class="n">q</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">):</span>
                <span class="n">service_name</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">check2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">check2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_val</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">service_val</span> <span class="o">=</span> <span class="n">service_val</span><span class="p">)</span>
        <span class="n">dockerfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dockerfile</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dockerfile&#39;</span><span class="p">)</span>
            <span class="n">build_path</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">debug</span><span class="p">(</span><span class="n">build_path</span> <span class="o">=</span> <span class="n">build_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">root_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">build_path</span> <span class="o">/</span> <span class="n">dockerfile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]ERROR:[/] [white on blue]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/], [bold #00FFFF]line: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="o">.</span><span class="n">tb_lineno</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No Dockerfile specified for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸŸ [bold #FFFF00]Service:[/] [bold #00FFFF]</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="DDF.read_dockerfile">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.read_dockerfile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_dockerfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">service_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">line_numbers</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the Dockerfile content from the given path with color syntax by rich.Syntax.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">service_name</span> <span class="k">else</span> <span class="n">path</span>
        <span class="c1"># print(f&quot;path: {path}&quot;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path provided or found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Dockerfile not found:[/] </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ”µ [yellow]Dockerfile is empty:[/] </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;dockerfile&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">line_numbers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[bold cyan]Dockerfile for service[/] &#39;[#FFFF00]</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">[/]&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">service_name</span> <span class="k">else</span> <span class="s2">&quot;[bold cyan]Dockerfile content:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="DDF.read_entrypoint1">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.read_entrypoint1">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_entrypoint1</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">read</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">line_numbers</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the entrypoint script for a given service.</span>
<span class="sd">        Tries to resolve the entrypoint path by analyzing COPY instructions in the Dockerfile.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">service_name</span> <span class="k">else</span> <span class="n">path</span>
        <span class="c1"># print(f&quot;path: {path}&quot;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path provided or found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Dockerfile not found:[/] </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Non</span>

        <span class="c1"># Get docker-compose.yml path and context dir</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

        <span class="n">entrypoint</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Parse Dockerfile for ENTRYPOINT and COPY</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Find ENTRYPOINT line</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line_strip</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line_strip</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">):</span>
                <span class="c1"># Support both ENTRYPOINT [&quot;...&quot;] and ENTRYPOINT &quot;...&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;found line: </span><span class="si">{</span><span class="n">line_strip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">line_strip</span> <span class="ow">and</span> <span class="s1">&#39;]&#39;</span> <span class="ow">in</span> <span class="n">line_strip</span><span class="p">:</span>
                        <span class="c1"># ENTRYPOINT [&quot;...&quot;] or ENTRYPOINT [&#39;...&#39;]</span>
                        <span class="n">entrypoint_str</span> <span class="o">=</span> <span class="n">line_strip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">entrypoint_list</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">entrypoint_str</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entrypoint_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entrypoint_list</span><span class="p">:</span>
                                <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint_str</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint_str</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># ENTRYPOINT ...</span>
                        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">line_strip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">entrypoint</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">line_strip</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;entrypoint&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="n">entrypoint</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No ENTRYPOINT found in Dockerfile for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Find COPY line that copies to the entrypoint destination</span>
        <span class="c1"># for line in lines:</span>
        <span class="c1">#     line_strip = line.strip()</span>
        <span class="c1">#     if line_strip.startswith(&#39;COPY&#39;) and entrypoint in line_strip:</span>
        <span class="c1">#         # Example: COPY ./entrypoint.sh /usr/local/bin/entrypoint.sh</span>
        <span class="c1">#         parts = line_strip.split()</span>
        <span class="c1">#         if len(parts) &gt;= 3:</span>
        <span class="c1">#             entrypoint_src = parts[1]</span>
        <span class="c1">#         break</span>

        <span class="c1"># If COPY ./entrypoint.sh ... found, resolve the source path</span>
        <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">entrypoint_src</span> <span class="ow">and</span> <span class="n">entrypoint_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
            <span class="n">entrypoint_src_file</span> <span class="o">=</span> <span class="n">entrypoint_src</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># remove ./</span>
            <span class="c1"># debug(entrypoint_src_file = entrypoint_src_file)</span>
            <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">,</span> <span class="n">entrypoint_src_file</span><span class="p">)</span>
            <span class="c1"># debug(entrypoint_path = entrypoint_path)</span>
        <span class="k">elif</span> <span class="n">entrypoint_src</span><span class="p">:</span>
            <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">,</span> <span class="n">entrypoint_src</span><span class="p">)</span>
            <span class="c1"># debug(entrypoint_path = entrypoint_path)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fallback: try to resolve entrypoint as relative to Dockerfile</span>
            <span class="c1"># debug(dockerfile_path = dockerfile_path)</span>
            <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
            <span class="c1"># debug(entrypoint_path = entrypoint_path)</span>

        <span class="c1"># debug(entrypoint = entrypoint, entrypoint_src = entrypoint_src, entrypoint_path = entrypoint_path)</span>
        <span class="c1"># debug(entrypoint_path_is_file = os.path.isfile(entrypoint_path))</span>
        <span class="c1"># Try absolute path if entrypoint is absolute and not found yet</span>
        <span class="k">if</span> <span class="n">entrypoint_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">):</span>
                <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">,</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">))</span>
                <span class="c1"># debug(alt_path = alt_path)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
                    <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">alt_path</span>

        <span class="c1"># print(f&quot;entrypoint: {entrypoint}&quot;)</span>
        <span class="c1"># print(f&quot;entrypoint_path: {entrypoint_path}&quot;)</span>
        <span class="c1"># print(f&quot;os.path.isfile(entrypoint_path): {os.path.isfile(entrypoint_path)}&quot;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Entrypoint script not found:[/] </span><span class="si">{</span><span class="n">entrypoint_path</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">entrypoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">read</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">script_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">script_content</span><span class="p">,</span> <span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">line_numbers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold cyan]Entrypoint script for service[/] &#39;[black on #FFFF00]</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">[/]&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading entrypoint script:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entrypoint_path</span></div>

    
<div class="viewcode-block" id="DDF.read_entrypoint2">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.read_entrypoint2">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_entrypoint2</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read the entrypoint script for a given service.</span>

<span class="sd">        Resolves the entrypoint path by:</span>
<span class="sd">          1. Parsing the Dockerfile for ENTRYPOINT</span>
<span class="sd">          2. Finding the corresponding COPY instruction</span>
<span class="sd">          3. Resolving the source path relative to the docker-compose build context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get Dockerfile path</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path found for service.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Dockerfile not found:[/] </span><span class="si">{</span><span class="n">dockerfile_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Load docker-compose.yml</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">compose_file</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]docker-compose.yml not found:[/] </span><span class="si">{</span><span class="n">compose_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">compose_content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">compose_content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">service_config</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">build_config</span> <span class="o">=</span> <span class="n">service_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">build_config</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; is not built from a Dockerfile (no &#39;build&#39; section).[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">build_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">compose_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>

        <span class="c1"># ðŸ”‘ VALIDASI: apakah build_ctx absolut atau relatif?</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">):</span>
            <span class="n">build_context_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">build_context_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">compose_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Build context directory not found:[/] </span><span class="si">{</span><span class="n">build_context_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Baca Dockerfile</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Kumpulkan semua COPY dan cari ENTRYPOINT</span>
        <span class="n">copy_instructions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COPY&#39;</span><span class="p">):</span>
                <span class="n">copy_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">):</span>
                <span class="c1"># Parse ENTRYPOINT</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rest</span> <span class="o">=</span> <span class="n">stripped</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rest</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">):</span>
                        <span class="n">parsed</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">parsed</span><span class="p">:</span>
                            <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">rest</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âš ï¸ [yellow]Failed to parse ENTRYPOINT:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">rest</span> <span class="k">if</span> <span class="s1">&#39;rest&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">break</span>  <span class="c1"># Ambil ENTRYPOINT pertama saja</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No ENTRYPOINT found in Dockerfile for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Cari COPY yang menyalin ke lokasi entrypoint</span>
        <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">copy_line</span> <span class="ow">in</span> <span class="n">copy_instructions</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">copy_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dst</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1"># Cocokkan berdasarkan nama file atau path penuh</span>
                <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="n">entrypoint</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">):</span>
                    <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="n">src</span>
                    <span class="k">break</span>

        <span class="c1"># ðŸ”‘ RESOLUSI PATH ENTRYPIONT</span>
        <span class="k">if</span> <span class="n">entrypoint_src</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">entrypoint_src</span><span class="p">):</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">entrypoint_src</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">entrypoint_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">)):</span>
                <span class="c1"># Relatif terhadap build context</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">entrypoint_src</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">if</span> <span class="n">entrypoint_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">entrypoint_src</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Misal: COPY entrypoint.sh /app/ â†’ src = &quot;entrypoint.sh&quot;</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">entrypoint_src</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: asumsikan entrypoint adalah file di build context</span>
            <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">)))</span>

        <span class="c1"># Cek apakah file ada</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">):</span>
            <span class="c1"># Coba alternatif: jika entrypoint absolut di dalam container, mungkin file di build context root</span>
            <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">alt_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Entrypoint script not found:[/] </span><span class="si">{</span><span class="n">entrypoint_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Tampilkan atau kembalikan path</span>
        <span class="k">if</span> <span class="n">read</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span>
                    <span class="n">content</span><span class="p">,</span>
                    <span class="s2">&quot;bash&quot;</span><span class="p">,</span>
                    <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span>
                    <span class="n">line_numbers</span><span class="o">=</span><span class="n">line_numbers</span><span class="p">,</span>
                    <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold cyan]Entrypoint script for service[/] &#39;[black on #FFFF00]</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">[/]&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading entrypoint script:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">entrypoint_path</span></div>


<div class="viewcode-block" id="DDF.read_entrypoint">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.read_entrypoint">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_entrypoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the entrypoint script for a given service.</span>
<span class="sd">        Supports partial name matching (e.g., &#39;auth&#39; matches &#39;auth-server&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Load docker-compose.yml to find actual service name</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">compose_file</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]docker-compose.yml not found:[/] </span><span class="si">{</span><span class="n">compose_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">compose_content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="n">matched_service</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">find_service</span><span class="p">(</span><span class="n">compose_content</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_service</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No service matching pattern &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Use the first matched service</span>
        <span class="n">actual_service_name</span> <span class="o">=</span> <span class="n">matched_service</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched_service</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">matched_service</span>
        <span class="n">service_config</span> <span class="o">=</span> <span class="n">compose_content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">actual_service_name</span><span class="p">]</span>

        <span class="n">build_config</span> <span class="o">=</span> <span class="n">service_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">build_config</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">actual_service_name</span><span class="si">}</span><span class="s2">&#39; is not built from a Dockerfile (no &#39;build&#39; section).[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get Dockerfile path using the ACTUAL service name</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">actual_service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Dockerfile not found for service &#39;</span><span class="si">{</span><span class="n">actual_service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Resolve build context correctly</span>
        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">build_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">compose_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">):</span>
            <span class="n">build_context_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">build_context_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">compose_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Build context directory not found:[/] </span><span class="si">{</span><span class="n">build_context_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Parse Dockerfile</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">copy_instructions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stripped</span> <span class="ow">or</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COPY&#39;</span><span class="p">):</span>
                <span class="n">copy_instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rest</span> <span class="o">=</span> <span class="n">stripped</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ENTRYPOINT&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rest</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">):</span>
                        <span class="n">parsed</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
                        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">parsed</span> <span class="k">else</span> <span class="n">rest</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âš ï¸ [yellow]Failed to parse ENTRYPOINT:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">rest</span> <span class="k">if</span> <span class="s1">&#39;rest&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No ENTRYPOINT found in Dockerfile for service &#39;</span><span class="si">{</span><span class="n">actual_service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Find matching COPY</span>
        <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">copy_line</span> <span class="ow">in</span> <span class="n">copy_instructions</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">copy_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dst</span> <span class="o">==</span> <span class="n">entrypoint</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">):</span>
                    <span class="n">entrypoint_src</span> <span class="o">=</span> <span class="n">src</span>
                    <span class="k">break</span>

        <span class="c1"># Resolve entrypoint path</span>
        <span class="k">if</span> <span class="n">entrypoint_src</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">entrypoint_src</span><span class="p">):</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">entrypoint_src</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">entrypoint_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">)):</span>
                <span class="n">rel</span> <span class="o">=</span> <span class="n">entrypoint_src</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">if</span> <span class="n">entrypoint_src</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">entrypoint_src</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">rel</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">entrypoint_src</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">):</span>
            <span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_context_path</span><span class="p">,</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">alt_path</span><span class="p">):</span>
                <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="n">alt_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Entrypoint script not found:[/] </span><span class="si">{</span><span class="n">entrypoint_path</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">entrypoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">read</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;bash&quot;</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">line_numbers</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold cyan]Entrypoint script for service[/] &#39;[black on #FFFF00]</span><span class="si">{</span><span class="n">actual_service_name</span><span class="si">}</span><span class="s2">[/]&#39;:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading entrypoint script:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">entrypoint_path</span></div>


<div class="viewcode-block" id="DDF.edit_entrypoint">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.edit_entrypoint">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_entrypoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit the entrypoint script for a given service using nvim, nano, or vim.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_entrypoint</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No entrypoint script found for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">BackupManager</span><span class="o">.</span><span class="n">create_backup</span><span class="p">(</span><span class="n">entrypoint_path</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span><span class="p">)</span>

        <span class="n">editors</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config_as_list</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;c:\msys64\usr\bin\nano.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EDITORS: </span><span class="si">{</span><span class="n">editors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">editors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">editor</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># subprocess.run([editor, entrypoint_path], check=True)</span>
                    <span class="n">safe_subprocess_run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="n">entrypoint_path</span><span class="p">])</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Entrypoint &#39;</span><span class="si">{</span><span class="n">entrypoint_path</span><span class="si">}</span><span class="s2">&#39; edited successfully.[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No suitable editor found to edit the entrypoint script.[/]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.edit_dockerfile">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.edit_dockerfile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_dockerfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit the Dockerfile using nvim, nano, or vim. Uses subprocess.run() and checks if the editor is installed.</span>
<span class="sd">        If the Dockerfile does not exist, create a new one in the build context directory.</span>
<span class="sd">        Handles absolute and relative dockerfile paths correctly, and always uses the build context if specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">service_name</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">service_name</span> <span class="o">=</span> <span class="n">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
                <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">build</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">dockerfile_name</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;Dockerfile&#39;</span><span class="p">)</span>
                <span class="n">root_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;root_path&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root_path</span><span class="p">):</span>
                    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">root_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>
                <span class="c1"># --- FIXED PATH LOGIC ---</span>
                <span class="c1"># If build_ctx is absolute, use as is, else join with base_dir</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">):</span>
                    <span class="n">build_dir</span> <span class="o">=</span> <span class="n">build_ctx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">build_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">))</span>
                <span class="c1"># If dockerfile_name is absolute, use as is, else join with build_dir</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">dockerfile_name</span><span class="p">):</span>
                    <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="n">dockerfile_name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_dir</span><span class="p">,</span> <span class="n">dockerfile_name</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error resolving Dockerfile path:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path provided or found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If Dockerfile does not exist, create an empty one in the build context</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# New Dockerfile</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[bold yellow]Created new Dockerfile at:[/] </span><span class="si">{</span><span class="n">dockerfile_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error creating Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Select editor</span>
        <span class="n">editors</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config_as_list</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;c:\msys64\usr\bin\nano.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">editors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">editor</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># subprocess.run([editor, dockerfile_path], check=True)</span>
                    <span class="n">safe_subprocess_run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="n">dockerfile_path</span><span class="p">])</span>
                    <span class="k">return</span>
                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No suitable editor found to edit the Dockerfile.[/]&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="DDF.edit_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.edit_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit a service section in the YAML file using nvim, nano, or vim.</span>
<span class="sd">        Only the selected service section will be edited and replaced back.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âš ï¸ [white on red]No service name provided for editing.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Load YAML</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c1"># Cari service yang cocok (pattern/wildcard/substring)</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">services</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service_name</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]Service pattern &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">svc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">. [bold cyan]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                
            <span class="n">q</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [bold yellow]Multiple services match &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span><span class="si">}</span><span class="s2">. Please specify which service to edit: [/]&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">):</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid service selection.[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">matched</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid input. Please enter a number.[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Unexpected error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
        <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ“ [bold #FFFF00]Opening[/] [bold #00FFFF]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/] [bold #FFFF00]service config in editor...</span><span class="se">\n</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">svc_data</span> <span class="o">=</span> <span class="n">services</span><span class="p">[</span><span class="n">svc</span><span class="p">]</span>
            <span class="c1"># Save Section to Temporary Files</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.yml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
                <span class="n">temp_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">name</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="n">svc</span><span class="p">:</span> <span class="n">svc_data</span><span class="p">},</span> <span class="n">tf</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># --- add hash before edit</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">before_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="c1"># Select Editor</span>
            <span class="n">editors</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config_as_list</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;c:\msys64\usr\bin\nano.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">editors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">editor</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># subprocess.run([editor, temp_path], check=True)</span>
                        <span class="n">safe_subprocess_run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="n">temp_path</span><span class="p">])</span>
                        <span class="k">break</span>
                    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Unexpected error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âš ï¸ [white on red]No suitable editor found to edit the service section.[/]&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1"># After editing, reread and replace the section</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
                    <span class="n">after_bytes</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="n">after_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">after_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">edited</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">after_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">before_hash</span> <span class="o">==</span> <span class="n">after_hash</span><span class="p">:</span>
                    <span class="n">is_changed</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made to service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">edited</span> <span class="ow">or</span> <span class="n">svc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">edited</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]No valid service section found after editing. Skipped update for[/] [bold #FFFF00]&#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">svc</span><span class="p">]</span> <span class="o">=</span> <span class="n">edited</span><span class="p">[</span><span class="n">svc</span><span class="p">]</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error reading edited service section:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [bold red]YAML not updated due to error above. Please fix indentation (use spaces, not tabs).[/bold red]&quot;</span><span class="p">)</span>
                <span class="k">return</span>  

        <span class="k">if</span> <span class="n">is_changed</span><span class="p">:</span>
            <span class="c1"># Backup before saving</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">create_backup</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [bold green]Service section(s) updated successfully in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error saving YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">backup_path</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ›‘ [yellow]A backup was created before editing: </span><span class="si">{</span><span class="n">backup_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">BackupManager</span><span class="o">.</span><span class="n">prompt_restore_backup</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ” [green]Backup restored for file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]Backup not restored. You may restore it manually if needed.[/]&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âš ï¸ [red]No backup available to restore.[/]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.edit_file">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.edit_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit a spesific file by line containt &#39;COPY&#39; in the Dockerfile.</span>
<span class="sd">        check relative path before if is file or not then edit</span>
<span class="sd">        if not or any not then show warning</span>
<span class="sd">        if success after edit then show info too but,</span>
<span class="sd">        if edit and not changed then show info too</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Dockerfile for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Cari baris COPY yang mengandung filename</span>
        <span class="n">copy_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">copy_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">copy_line</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No COPY line containing &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; found in Dockerfile for &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Ambil path sumber dari COPY</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">copy_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Malformed COPY line: </span><span class="si">{</span><span class="n">copy_line</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">src_path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Hilangkan &#39;./&#39; jika ada</span>
        <span class="k">if</span> <span class="n">src_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
            <span class="n">src_path</span> <span class="o">=</span> <span class="n">src_path</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="c1"># Resolve path relatif terhadap build context</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">,</span> <span class="n">src_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]File to edit not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Hash sebelum edit</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">before_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># Pilih editor</span>
        <span class="n">editors</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config_as_list</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;c:\msys64\usr\bin\nano.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">editors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">editor</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># subprocess.run([editor, file_path], check=True)</span>
                    <span class="n">safe_subprocess_run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">])</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No suitable editor found to edit the file.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Hash setelah edit</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">after_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">before_hash</span> <span class="o">==</span> <span class="n">after_hash</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made to file &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]File &#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&#39; edited successfully.[/]&quot;</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="DDF.read_file">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.read_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read and display a specific file referenced in a COPY line in the Dockerfile for a service.</span>
<span class="sd">        Shows syntax highlighting if possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Dockerfile for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Find COPY line containing filename</span>
        <span class="n">copy_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;COPY&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">copy_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">copy_line</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]No COPY line containing &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; found in Dockerfile for &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Get source path from COPY</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">copy_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Malformed COPY line: </span><span class="si">{</span><span class="n">copy_line</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">src_path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">src_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
            <span class="n">src_path</span> <span class="o">=</span> <span class="n">src_path</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="c1"># Resolve path relative to build context</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">service_val</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">service_val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">,</span> <span class="n">src_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">file_content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># Guess syntax from extension</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">syntax_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;.sh&#39;</span><span class="p">:</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.yml&#39;</span><span class="p">:</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.yaml&#39;</span><span class="p">:</span> <span class="s1">&#39;yaml&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.conf&#39;</span><span class="p">:</span> <span class="s1">&#39;ini&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.json&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.js&#39;</span><span class="p">:</span> <span class="s1">&#39;javascript&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.ts&#39;</span><span class="p">:</span> <span class="s1">&#39;typescript&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.env&#39;</span><span class="p">:</span> <span class="s1">&#39;bash&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.txt&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.ini&#39;</span><span class="p">:</span> <span class="s1">&#39;ini&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.md&#39;</span><span class="p">:</span> <span class="s1">&#39;markdown&#39;</span><span class="p">,</span>
                <span class="s1">&#39;.Dockerfile&#39;</span><span class="p">:</span> <span class="s1">&#39;dockerfile&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dockerfile&#39;</span><span class="p">:</span> <span class="s1">&#39;dockerfile&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">syntax_name</span> <span class="o">=</span> <span class="n">syntax_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">syntax_name</span> <span class="ow">and</span> <span class="s1">&#39;dockerfile&#39;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">syntax_name</span> <span class="o">=</span> <span class="s1">&#39;dockerfile&#39;</span>
            <span class="k">if</span> <span class="n">syntax_name</span><span class="p">:</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="n">Syntax</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">syntax_name</span><span class="p">,</span> <span class="n">theme</span><span class="o">=</span><span class="s2">&quot;fruity&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">line_numbers</span><span class="p">,</span> <span class="n">word_wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[bold cyan]File:[/] [#FFFF00]</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">syntax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[bold cyan]File:[/] [#FFFF00]</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="DDF.set_dockerfile">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.set_dockerfile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_dockerfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">dockerfile_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Dockerfile path for a given service in the docker-compose.yml.</span>
<span class="sd">        If the service does not exist, it will be created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Load YAML</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Ensure content is a dict</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Ensure &#39;services&#39; is a dict</span>
        <span class="k">if</span> <span class="s1">&#39;services&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">service_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Set Dockerfile path</span>
        <span class="k">if</span> <span class="s1">&#39;build&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">][</span><span class="s1">&#39;dockerfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dockerfile_path</span>

        <span class="c1"># Save back to the original file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold green]Dockerfile path set successfully for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error writing YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.new_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.new_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">service_config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new service section in the YAML file.</span>
<span class="sd">        If service exists, it will not be overwritten.</span>
<span class="sd">        If service_config is provided, it will be used as the initial configuration.</span>
<span class="sd">        After creation, open the new service in the editor for user to fill in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">service_name</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> âš ï¸ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; already exists.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Add the new service</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_config</span><span class="p">:</span>
            <span class="n">service_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">service_config</span>
        <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span>

        <span class="c1"># Save back to the file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold green]New service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; created successfully in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error writing YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Open the new service in the editor for user to fill in</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">edit_service</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="n">service_name</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="DDF.copy_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.copy_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy a service section to the clipboard.</span>
<span class="sd">        The service section will be formatted as YAML and copied.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">service_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Get the service section</span>
        <span class="n">service_section</span> <span class="o">=</span> <span class="p">{</span><span class="n">service_name</span><span class="p">:</span> <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]}</span>
        <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">service_section</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Copy to clipboard</span>
        <span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold green]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; copied to clipboard successfully.[/]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.rename_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.rename_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">rename_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">old_service_name</span><span class="p">,</span> <span class="n">new_service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rename a service section in the YAML file.</span>
<span class="sd">        If the new service name already exists, it will not overwrite it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">old_service_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">old_service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">new_service_name</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">new_service_name</span><span class="si">}</span><span class="s2">&#39; already exists. Cannot rename.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Rename the service</span>
        <span class="n">services</span><span class="p">[</span><span class="n">new_service_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_service_name</span><span class="p">)</span>
        <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span>

        <span class="c1"># Save back to the file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold green]Service &#39;</span><span class="si">{</span><span class="n">old_service_name</span><span class="si">}</span><span class="s2">&#39; renamed to &#39;</span><span class="si">{</span><span class="n">new_service_name</span><span class="si">}</span><span class="s2">&#39; successfully in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error writing YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.copy_dockerfile">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.copy_dockerfile">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy_dockerfile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the Dockerfile content to the clipboard for a given service.</span>
<span class="sd">        If the Dockerfile does not exist, it will not copy anything.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile found for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]Dockerfile not found:[/] </span><span class="si">{</span><span class="n">dockerfile_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dockerfile_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [#FFFF00]Dockerfile content for service[/] [#00FFFF]&#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;[/] [#FFFF00]copied to clipboard successfully.[/]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error reading Dockerfile:[/] [white on red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.copy_dockerfile_config">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.copy_dockerfile_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy_dockerfile_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">from_svc_name</span><span class="p">,</span> <span class="n">to_svc_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy Dockerfile from ``from_svc_name`` into the build context of ``to_svc_name``</span>
<span class="sd">        and update docker-compose file for ``to_svc_name`` to point to the copied Dockerfile.</span>

<span class="sd">        Behavior:</span>

<span class="sd">        - If target build context directory doesn&#39;t exist it will be created.</span>
<span class="sd">        - If a Dockerfile already exists at target, a unique name will be chosen:</span>
<span class="sd">          ``Dockerfile``, ``Dockerfile-&lt;svc&gt;``, ``Dockerfile-&lt;svc&gt;-1``, ...</span>
<span class="sd">        - After successful copy, ``docker-compose.yml`` will be updated:</span>
<span class="sd">          ``services[to_svc_name].build.dockerfile = &lt;relative-or-basename&gt;``</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or None: Path to created file on success, None on failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># resolve source Dockerfile</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">src_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">from_svc_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error resolving source Dockerfile for &#39;</span><span class="si">{</span><span class="n">from_svc_name</span><span class="si">}</span><span class="s2">&#39;:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">src_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">src_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Source Dockerfile not found for service &#39;</span><span class="si">{</span><span class="n">from_svc_name</span><span class="si">}</span><span class="s2">&#39;:[/] </span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># compose file</span>
        <span class="n">compose_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">compose_file</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]docker-compose file not found:[/] </span><span class="si">{</span><span class="n">compose_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading compose file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">to_svc_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âš ï¸ [yellow]Target service &#39;</span><span class="si">{</span><span class="n">to_svc_name</span><span class="si">}</span><span class="s2">&#39; not found in compose. Creating minimal section...[/]&quot;</span><span class="p">)</span>
            <span class="n">services</span><span class="p">[</span><span class="n">to_svc_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span>

        <span class="n">target_service</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">to_svc_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">build_cfg</span> <span class="o">=</span> <span class="n">target_service</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">build_ctx</span> <span class="o">=</span> <span class="n">build_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">dockerfile_name_cfg</span> <span class="o">=</span> <span class="n">build_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;Dockerfile&#39;</span><span class="p">)</span>

        <span class="c1"># determine base dir for relative contexts</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;root_path&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">root_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">root_path</span><span class="p">):</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="n">root_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">compose_file</span><span class="p">))</span>

        <span class="c1"># resolve build_dir (absolute)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">):</span>
            <span class="n">build_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">build_ctx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">build_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">build_ctx</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">build_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Failed to create target build context &#39;</span><span class="si">{</span><span class="n">build_dir</span><span class="si">}</span><span class="s2">&#39;:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># pick candidate name in build_dir</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_dir</span><span class="p">,</span> <span class="s1">&#39;Dockerfile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Dockerfile-</span><span class="si">{</span><span class="n">to_svc_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
            <span class="n">safe_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z0-9._-]+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">to_svc_name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">to_svc_name</span>
            <span class="n">base_candidate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Dockerfile-</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">final_name</span> <span class="o">=</span> <span class="n">base_candidate</span> <span class="k">if</span> <span class="n">seq</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_candidate</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">final_name</span><span class="p">):</span>
                    <span class="n">candidate</span> <span class="o">=</span> <span class="n">final_name</span>
                    <span class="k">break</span>
                <span class="n">seq</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># copy</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [green]Dockerfile copied:[/] </span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">candidate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Failed to copy Dockerfile:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># compute value to write into compose: prefer path relative to build context</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rel</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">build_dir</span><span class="p">)</span>
            <span class="n">dockerfile_value</span> <span class="o">=</span> <span class="n">rel</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rel</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">dockerfile_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>

        <span class="c1"># update compose content structure and write back (with backup)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ensure services and build dicts exist</span>
            <span class="k">if</span> <span class="s1">&#39;services&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">to_svc_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;build&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">to_svc_name</span><span class="p">][</span><span class="s1">&#39;build&#39;</span><span class="p">][</span><span class="s1">&#39;dockerfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dockerfile_value</span>

            <span class="c1"># backup current compose file</span>
            <span class="n">BackupManager</span><span class="o">.</span><span class="n">create_backup</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span><span class="c1">#, operation_type=&quot;update-dockerfile&quot;)</span>

            <span class="c1"># write</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">compose_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Updated compose: set services.</span><span class="si">{</span><span class="n">to_svc_name</span><span class="si">}</span><span class="s2">.build.dockerfile -&gt; </span><span class="si">{</span><span class="n">dockerfile_value</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">compose_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Failed to update compose file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">candidate</span>  <span class="c1"># copying worked, but updating failed; still return candidate</span></div>

        
<div class="viewcode-block" id="DDF.duplicate_server">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.duplicate_server">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">duplicate_server</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">new_service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Duplicate a service section in the YAML file.</span>
<span class="sd">        The new service will have the same configuration as the original service.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">duplicating</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">services</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
            <span class="c1"># Duplicate the service</span>
            <span class="n">services</span><span class="p">[</span><span class="n">new_service_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span>
            <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span>
    
            <span class="c1"># Save back to the file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âœ… [bold green]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; duplicated to &#39;</span><span class="si">{</span><span class="n">new_service_name</span><span class="si">}</span><span class="s2">&#39; successfully in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error writing YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">find_service</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">matched</span>
            <span class="n">duplicating</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">services</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold #FFFF00]Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;services&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matched</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">service</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. [#FF5500]</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[bold #FFFF00]select number:[/] &quot;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">):</span>
                    <span class="n">duplicating</span><span class="p">(</span><span class="n">matched</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">services</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.remove_service">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.remove_service">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove_service</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a service section from the YAML file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">service_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">services</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [yellow]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Remove the service</span>
        <span class="k">del</span> <span class="n">services</span><span class="p">[</span><span class="n">service_name</span><span class="p">]</span>
        <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">services</span>

        <span class="c1"># Save back to the file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> âš ï¸ [bold green]Service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; removed successfully from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/bold green]&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> âŒ [red]Error writing YAML file:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="DDF.get_version">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.get_version">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the version of the ddf module.</span>
<span class="sd">        Version is taken from the __version__.py file if it exists.</span>
<span class="sd">        The content of __version__.py should be:</span>
<span class="sd">        version = &quot;0.33&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;__version__.py&quot;</span>
            <span class="k">if</span> <span class="n">version_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">version_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">):</span>
                            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">debug</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">return</span> <span class="s2">&quot;UNKNOWN VERSION&quot;</span></div>

        
<div class="viewcode-block" id="DDF.show_debug">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.show_debug">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show_debug</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">})</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;DEBUG_SERVER&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">})</span></div>

        
<div class="viewcode-block" id="DDF.get_content">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.get_content">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="nd">@cache_with_invalidation</span><span class="p">(</span><span class="n">validation</span> <span class="o">=</span> <span class="n">compare_hash</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compose_file</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">compose_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>            
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span></div>

    
<div class="viewcode-block" id="DDF.usage">
<a class="viewcode-back" href="../../api/core.html#ddf.DDF.usage">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">default_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Detect or list ports in a Docker Compose file.&quot;</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">CustomRichHelpFormatter</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;service&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Service name to inspect&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_file</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--list&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List ports for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--detail&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show full configuration for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--find&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Find port in all services&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--port&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Check if PORT is duplicate among all services&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="s1">&#39;--device&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show devices for the given service or all services&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-vol&#39;</span><span class="p">,</span> <span class="s1">&#39;--volumes&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show devices for the given service or all services&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="s1">&#39;--VOLUMES&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show Volumes Section&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-P&#39;</span><span class="p">,</span> <span class="s1">&#39;--list-port&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all ports in the YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-L&#39;</span><span class="p">,</span> <span class="s1">&#39;--list-service-name&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all service names in the YAML file&quot;</span><span class="p">)</span>
        <span class="c1"># parser.add_argument(&#39;-r&#39;, &#39;--dockerfile&#39;, metavar=&#39;SERVICE&#39;, help=&quot;Read and display the Dockerfile for the given service&quot;)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display the Dockerfile for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the Dockerfile for the given service using nvim, nano, or vim&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-sd&#39;</span><span class="p">,</span> <span class="s1">&#39;--set-dockerfile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;DOCKERFILE_PATH&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the Dockerfile path for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-E&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-service&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the service section for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dd&#39;</span><span class="p">,</span> <span class="s1">&#39;--duplicate-service&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;NEW_SERVICE_NAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duplicate the service section with a new service name&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cs&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-service&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;copy service section to clipboar&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rn&#39;</span><span class="p">,</span> <span class="s1">&#39;--rename-service&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;NEW_SERVICE_NAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Rename the service section to a new name&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cd&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Copy the Dockerfile content to clipboard&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-en&#39;</span><span class="p">,</span> <span class="s1">&#39;--entrypoint&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display the entrypoint script for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-ed&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-entrypoint&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the entrypoint script for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rm&#39;</span><span class="p">,</span> <span class="s1">&#39;--remove-service&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove the service section for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--all&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show all services and their ports, devices, and volumes&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-nl&#39;</span><span class="p">,</span> <span class="s1">&#39;--no-line-numbers&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable line numbers in syntax highlighting&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-hn&#39;</span><span class="p">,</span> <span class="s1">&#39;--hostname&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show hostname for the service if available&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--new&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Create a new service section in the YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-F&#39;</span><span class="p">,</span> <span class="s1">&#39;--filter&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Filter services by name or pattern&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;%(prog)s </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show the version of ddf module&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-ef&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit a specific file in the Dockerfile COPY command&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rf&#39;</span><span class="p">,</span> <span class="s1">&#39;--read-file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display a specific file in the Dockerfile COPY command&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--theme&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;fruity&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the theme for syntax highlighting (default: fruity)&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">DDF</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">default_file</span><span class="p">)</span>
                <span class="n">DDF</span><span class="o">.</span><span class="n">find_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;-h&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s1">&#39;--help&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">DDF</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>            
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">theme</span><span class="p">:</span>
            <span class="c1"># console.set_theme(args.theme)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">THEME</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">theme</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_service_devices</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_service_volumes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">VOLUMES</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_volumes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">list_port</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">DDF</span><span class="o">.</span><span class="n">list_service_ports</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service specified for listing ports.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">hostname</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_hostnames</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">check_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">find</span> <span class="ow">or</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">find_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">find</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">detail</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">show_service_detail</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_service_ports</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">dockerfile</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">read_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">read_entrypoint</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_entrypoint</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">edit_entrypoint</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">remove_service</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">remove_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path provided for setting.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">:</span>
                <span class="n">DDF</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_service</span><span class="p">:</span>
                <span class="n">DDF</span><span class="o">.</span><span class="n">edit_service</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">dockerfile</span><span class="p">:</span>
                <span class="n">DDF</span><span class="o">.</span><span class="n">read_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No filename provided for editing.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">edit_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No filename provided for reading.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">list_service_name</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_service_names</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_service</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">edit_service</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="n">ars</span><span class="o">.</span><span class="n">detach</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for new service.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">new_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">copy_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">copy_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">copy_dockerfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying Dockerfile.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">copy_dockerfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">rename_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying Dockerfile.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">rename_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">rename_service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">duplicate_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for duplication.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">duplicate_server</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">duplicate_service</span><span class="p">)</span>
        <span class="c1">#if only service is provided, check for duplicate ports</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">_option_string_actions</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">len_filter__option_string_actions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]))))</span>
        <span class="c1"># if args.service and not (args.list or args.detail or args.dockerfile or args.entrypoint or args.edit_dockerfile or args.edit_entrypoint or args.set_dockerfile or args.edit_service or args.remove_service or args.copy_service or args.copy_dockerfile or args.duplicate_service):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])))</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">find_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_service</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span></div>
</div>


<span class="k">class</span> <span class="nc">FileChangeHandler</span><span class="p">(</span><span class="n">FileSystemEventHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles file change events for monitoring edited files.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">debounce_time</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debounce_time</span> <span class="o">=</span> <span class="n">debounce_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">on_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_directory</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="n">event_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event_path</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">debounce_time</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">current_time</span>
                    <span class="c1"># Use a timer to debounce rapid successive changes</span>
                    <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debounce_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_callback</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_execute_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute callback after debounce period.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error in file change callback:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="EnhancedBackupManager">
<a class="viewcode-back" href="../../api/backup.html#ddf.EnhancedBackupManager">[docs]</a>
<span class="k">class</span> <span class="nc">EnhancedBackupManager</span><span class="p">(</span><span class="n">BackupManager</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced backup manager with better integration and monitoring.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="EnhancedBackupManager.create_backup_with_context">
<a class="viewcode-back" href="../../api/backup.html#ddf.EnhancedBackupManager.create_backup_with_context">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_backup_with_context</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span><span class="p">,</span> <span class="n">context_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create backup with additional context information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file to backup</span>
<span class="sd">            operation_type: Type of operation (edit, update, delete, etc.)</span>
<span class="sd">            context_info: Additional context like service name, action type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]File does not exist, cannot create backup: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="n">backup_dir</span> <span class="o">=</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">get_backup_dir</span><span class="p">()</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            
            <span class="c1"># Include context info in backup filename</span>
            <span class="n">context_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">context_info</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">context_info</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">backup_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">operation_type</span><span class="si">}{</span><span class="n">context_str</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.backup&quot;</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">,</span> <span class="n">backup_filename</span><span class="p">)</span>
            
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">backup_path</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ’¾ [cyan]Backup created:[/] </span><span class="si">{</span><span class="n">backup_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">backup_path</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Failed to create backup:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

    
<div class="viewcode-block" id="EnhancedBackupManager.should_create_backup">
<a class="viewcode-back" href="../../api/backup.html#ddf.EnhancedBackupManager.should_create_backup">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">should_create_backup</span><span class="p">(</span><span class="n">operation_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if backup should be created for this operation type.&quot;&quot;&quot;</span>
        <span class="n">backup_operations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;edit_service&#39;</span><span class="p">,</span> <span class="s1">&#39;edit_dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;edit_entrypoint&#39;</span><span class="p">,</span> <span class="s1">&#39;edit_file&#39;</span><span class="p">,</span>
            <span class="s1">&#39;remove_service&#39;</span><span class="p">,</span> <span class="s1">&#39;rename_service&#39;</span><span class="p">,</span> <span class="s1">&#39;set_dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;new_service&#39;</span><span class="p">,</span>
            <span class="s1">&#39;duplicate_service&#39;</span><span class="p">,</span> <span class="s1">&#39;copy_dockerfile_config&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">operation_type</span> <span class="ow">in</span> <span class="n">backup_operations</span></div>
</div>


<div class="viewcode-block" id="EditorManager">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager">[docs]</a>
<span class="k">class</span> <span class="nc">EditorManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages different types of editors and their behaviors.&quot;&quot;&quot;</span>
    
    <span class="n">BLOCKING_EDITORS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nano&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;emacs&#39;</span><span class="p">]</span>
    <span class="n">NON_BLOCKING_EDITORS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sublime_text&#39;</span><span class="p">,</span> <span class="s1">&#39;subl&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;atom&#39;</span><span class="p">,</span> <span class="s1">&#39;notepad++&#39;</span><span class="p">]</span>
    <span class="n">SPECIAL_HANDLING</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;subl&#39;</span><span class="p">:</span> <span class="s1">&#39;sublime_wait&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sublime_text&#39;</span><span class="p">:</span> <span class="s1">&#39;sublime_wait&#39;</span>
    <span class="p">}</span>
    
<div class="viewcode-block" id="EditorManager.edit_file_with_monitoring">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager.edit_file_with_monitoring">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_file_with_monitoring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback_on_save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Edit file with appropriate monitoring based on editor type.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            file_path: Path to file to edit</span>
<span class="sd">            callback_on_save: Function to call when file is saved</span>
<span class="sd">            timeout: Timeout for monitoring in seconds (5 minutes default)</span>
<span class="sd">            detached: Open editor in new terminal window</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Debug mode</span>
        <span class="n">debug_mode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DDF_DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: file_path=</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: detached=</span><span class="si">{</span><span class="n">detached</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: timeout=</span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        

        <span class="n">editors</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config_as_list</span><span class="p">(</span><span class="s1">&#39;editor&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[</span>
            <span class="sa">r</span><span class="s1">&#39;c:\msys64\usr\bin\nano.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;nvim&#39;</span><span class="p">,</span> <span class="s1">&#39;vim&#39;</span><span class="p">,</span> <span class="s1">&#39;subl&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: editors=</span><span class="si">{</span><span class="n">editors</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
    
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">original_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: original_hash=</span><span class="si">{</span><span class="n">original_hash</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">editors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">editor</span><span class="p">):</span>
                <span class="n">editor_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_editor_type</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">debug_mode</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[dim]Debug: trying editor=</span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">, type=</span><span class="si">{</span><span class="n">editor_type</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># DETACHED MODE for blocking editors</span>
                    <span class="k">if</span> <span class="n">detached</span> <span class="ow">and</span> <span class="n">editor_type</span> <span class="o">==</span> <span class="s1">&#39;blocking&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_edit_with_detached_terminal</span><span class="p">(</span>
                            <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback_on_save</span><span class="p">,</span> <span class="n">original_hash</span>
                        <span class="p">)</span>
                    
                    <span class="c1"># Normal mode</span>
                    <span class="k">if</span> <span class="n">editor_type</span> <span class="o">==</span> <span class="s1">&#39;blocking&#39;</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">safe_subprocess_run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)])</span>
                        <span class="k">if</span> <span class="n">callback_on_save</span><span class="p">:</span>
                            <span class="n">new_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">new_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                                <span class="n">callback_on_save</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">callback_on_save</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">editor_type</span> <span class="o">==</span> <span class="s1">&#39;sublime_wait&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_edit_with_sublime_wait</span><span class="p">(</span>
                            <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback_on_save</span><span class="p">,</span> <span class="n">original_hash</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># return cls._edit_with_file_monitoring(</span>
                        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">edit_file_with_monitoring</span><span class="p">(</span>
                            <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback_on_save</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">original_hash</span>
                        <span class="p">)</span>
                        
                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error launching </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Unexpected error with </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
        
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]No suitable editor found.[/]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    
<div class="viewcode-block" id="EditorManager._edit_with_file_monitoring">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager._edit_with_file_monitoring">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_edit_with_file_monitoring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">edit_file_with_monitoring</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditorManager._edit_with_detached_terminal">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager._edit_with_detached_terminal">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_edit_with_detached_terminal</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">original_hash</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open editor in new terminal window and monitor file changes.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">platform</span>
        
        <span class="n">system</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ”§ [cyan]Opening </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2"> in new terminal window...[/]&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
                <span class="c1"># Windows: Use start command</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;/c&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="s1">&#39;/k&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)]</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>  <span class="c1"># macOS</span>
                <span class="c1"># macOS: Use Terminal.app or iTerm2</span>
                <span class="n">script</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                tell application &quot;Terminal&quot;</span>
<span class="s1">                    do script &quot;</span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">shlex</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span><span class="si">}</span><span class="s1">&quot;</span>
<span class="s1">                    activate</span>
<span class="s1">                end tell</span>
<span class="s1">                &#39;&#39;&#39;</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;osascript&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="n">script</span><span class="p">])</span>
                
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
                <span class="c1"># Linux: Try common terminal emulators</span>
                <span class="n">terminals</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span><span class="s1">&#39;gnome-terminal&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                    <span class="p">[</span><span class="s1">&#39;konsole&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                    <span class="p">[</span><span class="s1">&#39;xterm&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                    <span class="p">[</span><span class="s1">&#39;alacritty&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                    <span class="p">[</span><span class="s1">&#39;kitty&#39;</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                    <span class="p">[</span><span class="s1">&#39;terminator&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                <span class="p">]</span>
                
                <span class="n">launched</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">term_cmd</span> <span class="ow">in</span> <span class="n">terminals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">term_cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">term_cmd</span><span class="p">)</span>
                        <span class="n">launched</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">launched</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]No suitable terminal emulator found[/]&quot;</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[yellow]Install one of: gnome-terminal, konsole, xterm, alacritty[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Unsupported OS: </span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            
            <span class="c1"># Monitor file changes</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â±ï¸ [yellow]Monitoring file for changes...[/]&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ’¡ [cyan]Save and close the editor when done[/]&quot;</span><span class="p">)</span>
            
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">last_hash</span> <span class="o">=</span> <span class="n">original_hash</span>
            <span class="n">check_interval</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Check every 2 seconds</span>
            
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">check_interval</span><span class="p">)</span>
                
                <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                
                <span class="c1"># Detect change</span>
                <span class="k">if</span> <span class="n">current_hash</span> <span class="o">!=</span> <span class="n">last_hash</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]File change detected![/]&quot;</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â³ [cyan]Waiting 3 seconds for additional changes...[/]&quot;</span><span class="p">)</span>
                    
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    
                    <span class="n">changed</span> <span class="o">=</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span>
                    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Changes saved successfully![/]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No final changes detected[/]&quot;</span><span class="p">)</span>
                    
                    <span class="k">return</span> <span class="kc">True</span>
                
                <span class="c1"># Check timeout (default 10 minutes for detached mode)</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â° [yellow]Monitoring timeout (10 minutes)[/]&quot;</span><span class="p">)</span>
                    <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span>
                    
                    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes detected![/]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes detected[/]&quot;</span><span class="p">)</span>
                    
                    <span class="k">return</span> <span class="kc">True</span>
                    
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âš ï¸ [yellow]Monitoring cancelled[/]&quot;</span><span class="p">)</span>
            <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes saved before cancellation[/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes detected[/]&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error in detached mode: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="EditorManager.get_editor_type">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager.get_editor_type">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_editor_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">editor_cmd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if editor is blocking or non-blocking.&quot;&quot;&quot;</span>
        <span class="n">editor_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">editor_cmd</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="c1"># Check for special handling first</span>
        <span class="k">if</span> <span class="n">editor_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SPECIAL_HANDLING</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">SPECIAL_HANDLING</span><span class="p">[</span><span class="n">editor_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">blocked</span> <span class="ow">in</span> <span class="n">editor_name</span> <span class="k">for</span> <span class="n">blocked</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">BLOCKING_EDITORS</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;blocking&#39;</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">non_blocked</span> <span class="ow">in</span> <span class="n">editor_name</span> <span class="k">for</span> <span class="n">non_blocked</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NON_BLOCKING_EDITORS</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;non_blocking&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default to blocking for unknown editors</span>
            <span class="k">return</span> <span class="s1">&#39;blocking&#39;</span></div>

    
    <span class="c1"># @classmethod</span>
    <span class="c1"># def edit_file_with_monitoring(cls, file_path, callback_on_save=None, timeout=300, detached=False):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Edit file with appropriate monitoring based on editor type.</span>
        
    <span class="c1">#     Args:</span>
    <span class="c1">#         file_path: Path to file to edit</span>
    <span class="c1">#         callback_on_save: Function to call when file is saved</span>
    <span class="c1">#         timeout: Timeout for monitoring in seconds (5 minutes default)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     editors = CONFIG.get_config_as_list(&#39;editor&#39;, &#39;names&#39;) or [</span>
    <span class="c1">#         r&#39;c:\msys64\usr\bin\nano.exe&#39;, &#39;nvim&#39;, &#39;vim&#39;, &#39;subl&#39;, &#39;code&#39;</span>
    <span class="c1">#     ]</span>
        
    <span class="c1">#     # print(f&quot;EDITORS: {editors}&quot;)  # Debug output</span>
        
    <span class="c1">#     os.makedirs(os.path.dirname(file_path), exist_ok=True)</span>
    <span class="c1">#     file_path = Path(file_path).resolve()</span>
    <span class="c1">#     original_hash = cls._get_file_hash(file_path) if file_path.exists() else None</span>
        
    <span class="c1">#     for editor in editors:</span>
    <span class="c1">#         if shutil.which(editor):</span>
    <span class="c1">#             editor_type = cls.get_editor_type(editor)</span>
                
    <span class="c1">#             try:</span>
    <span class="c1">#                 if editor_type == &#39;blocking&#39;:</span>
    <span class="c1">#                     # For blocking editors, just run and wait</span>
    <span class="c1">#                     # result = subprocess.run([editor, str(file_path)], check=True)</span>
    <span class="c1">#                     result = safe_subprocess.run([editor, str(file_path)])</span>
    <span class="c1">#                     if callback_on_save:</span>
    <span class="c1">#                         new_hash = cls._get_file_hash(file_path)</span>
    <span class="c1">#                         if new_hash != original_hash:</span>
    <span class="c1">#                             callback_on_save(file_path, changed=True)</span>
    <span class="c1">#                         else:</span>
    <span class="c1">#                             callback_on_save(file_path, changed=False)</span>
    <span class="c1">#                     return True</span>
    <span class="c1">#                 elif editor_type == &#39;sublime_wait&#39;:</span>
    <span class="c1">#                     # Special handling for Sublime Text with wait flag</span>
    <span class="c1">#                     return cls._edit_with_sublime_wait(</span>
    <span class="c1">#                         editor, file_path, callback_on_save, original_hash</span>
    <span class="c1">#                     )</span>
    <span class="c1">#                 else:</span>
    <span class="c1">#                     # For non-blocking editors, start monitoring</span>
    <span class="c1">#                     return cls._edit_with_file_monitoring(</span>
    <span class="c1">#                         editor, file_path, callback_on_save, timeout, original_hash</span>
    <span class="c1">#                     )</span>
                        
    <span class="c1">#             except subprocess.CalledProcessError as e:</span>
    <span class="c1">#                 console.print(f&quot;âŒ [red]Error launching {editor}:[/] {e}&quot;)</span>
    <span class="c1">#                 continue</span>
    <span class="c1">#             except Exception as e:</span>
    <span class="c1">#                 console.print(f&quot;âŒ [red]Unexpected error with {editor}:[/] {e}&quot;)</span>
    <span class="c1">#                 continue</span>
        
    <span class="c1">#     console.print(&quot;âŒ [red]No suitable editor found.[/]&quot;)</span>
    <span class="c1">#     return False</span>
    
<div class="viewcode-block" id="EditorManager._edit_with_sublime_wait">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager._edit_with_sublime_wait">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_edit_with_sublime_wait</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">original_hash</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Special handling for Sublime Text with --wait flag.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try with --wait flag first</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ”§ [cyan]Starting </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2"> with --wait flag for </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="s1">&#39;--wait&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
            
            <span class="c1"># IMPORTANT: Give file system time to sync</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># â† FIX: Wait for file system</span>
        
            <span class="c1"># Check for changes after editor closes</span>
            <span class="n">new_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="n">new_hash</span> <span class="o">!=</span> <span class="n">original_hash</span>
            
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes detected and saved![/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes detected[/]&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="n">changed</span><span class="p">)</span>
                
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â° [yellow]Sublime Text editing timeout (10 minutes)[/]&quot;</span><span class="p">)</span>
            <span class="c1"># Still check for changes</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># â† FIX: Wait for file system</span>
            <span class="n">new_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="n">new_hash</span> <span class="o">!=</span> <span class="n">original_hash</span>

            <span class="k">if</span> <span class="n">callback</span> <span class="ow">and</span> <span class="n">new_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes detected (timeout)![/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes detected[/]&quot;</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="kc">True</span>
            
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="c1"># If --wait doesn&#39;t work, try alternative approach</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]--wait flag not supported, using alternative method[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_edit_with_sublime_alternative</span><span class="p">(</span><span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">original_hash</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="EditorManager._edit_with_sublime_alternative">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager._edit_with_sublime_alternative">[docs]</a>
    <span class="nd">@classmethod</span> 
    <span class="k">def</span> <span class="nf">_edit_with_sublime_alternative</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">original_hash</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Alternative method for Sublime Text without --wait flag.&quot;&quot;&quot;</span>
        <span class="c1"># Create a more permanent temp file in a known location</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.ddf_temp&#39;</span>
        <span class="n">temp_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Use a more descriptive filename</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">service_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stem</span> <span class="k">else</span> <span class="s1">&#39;service&#39;</span>
        <span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;edit_</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.yml&quot;</span>
        
        <span class="c1"># Copy content to the new temp file</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">temp_file</span><span class="p">)</span>
        
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ“ [cyan]Created temp file: </span><span class="si">{</span><span class="n">temp_file</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ”§ [cyan]Opening in </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">...[/]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ’¡ [yellow]Please save and close the file when done editing[/]&quot;</span><span class="p">)</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â±ï¸ [yellow]Waiting for changes... (Press Ctrl+C to cancel)[/]&quot;</span><span class="p">)</span>
        
        <span class="c1"># Start Sublime Text</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">editor</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Failed to start </span><span class="si">{</span><span class="n">editor</span><span class="si">}</span><span class="s2">:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="c1"># Monitor the temp file for changes</span>
        <span class="n">last_hash</span> <span class="o">=</span> <span class="n">original_hash</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Check every second</span>
                
                <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">current_hash</span> <span class="o">!=</span> <span class="n">last_hash</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]File change detected![/]&quot;</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â³ [cyan]Waiting 2 seconds for additional changes...[/]&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Wait a bit more to catch any additional saves</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                        <span class="c1"># Copy changes back to original file</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                            <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Changes applied successfully![/]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                            <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No final changes detected[/]&quot;</span><span class="p">)</span>
                    
                    <span class="k">break</span>
                
                <span class="c1"># Timeout after 10 minutes</span>
                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â° [yellow]Timeout reached. Checking for any changes...[/]&quot;</span><span class="p">)</span>
                    <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                            <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes found and applied![/]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                            <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made[/]&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                    
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âš ï¸ [yellow]Monitoring cancelled by user[/]&quot;</span><span class="p">)</span>
            <span class="c1"># Still check for changes before exiting</span>
            <span class="n">final_hash</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_file_hash</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">final_hash</span> <span class="o">!=</span> <span class="n">original_hash</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;ðŸ’¾ [cyan]Changes detected. Apply them? (y/N): [/]&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Changes applied![/]&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Changes discarded[/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
                    <span class="n">callback</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes to apply[/]&quot;</span><span class="p">)</span>
        
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Clean up temp file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">temp_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ§¹ [cyan]Cleaned up temp file[/]&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        
        <span class="k">return</span> <span class="kc">True</span></div>

    
<div class="viewcode-block" id="EditorManager._get_file_hash">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager._get_file_hash">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get SHA256 hash of file content with retry logic.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retry</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">None</span>
                
                <span class="c1"># Wait a bit if not first attempt</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    
            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># File might be locked by editor</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">retry</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to hash file after </span><span class="si">{</span><span class="n">retry</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error hashing file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="EditorManager.cleanup_temp_files">
<a class="viewcode-back" href="../../api/editor.html#ddf.EditorManager.cleanup_temp_files">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cleanup_temp_files</span><span class="p">(</span><span class="n">max_age_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up old temporary files from .ddf_temp directory.&quot;&quot;&quot;</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;.ddf_temp&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span>
        
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">max_age_seconds</span> <span class="o">=</span> <span class="n">max_age_hours</span> <span class="o">*</span> <span class="mi">3600</span>
        <span class="n">cleaned_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">temp_file</span> <span class="ow">in</span> <span class="n">temp_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;edit_*&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="n">file_age</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>
                    <span class="k">if</span> <span class="n">file_age</span> <span class="o">&gt;</span> <span class="n">max_age_seconds</span><span class="p">:</span>
                        <span class="n">temp_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                        <span class="n">cleaned_count</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">cleaned_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ§¹ [cyan]Cleaned up </span><span class="si">{</span><span class="n">cleaned_count</span><span class="si">}</span><span class="s2"> old temporary files[/]&quot;</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]Warning: Could not clean temp files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="EnhancedDDF">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF">[docs]</a>
<span class="k">class</span> <span class="nc">EnhancedDDF</span><span class="p">(</span><span class="n">DDF</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Enhanced DDF class with improved backup and editor handling.&quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="EnhancedDDF.edit_service_enhanced">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF.edit_service_enhanced">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_service_enhanced</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enhanced edit_service with better backup and monitoring.&quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]No service name provided for editing.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]YAML file not found:[/] </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Validate service name</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">service_name</span> <span class="o">=</span> <span class="n">validate_service_name</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create backup before any changes</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">create_backup_with_context</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span> 
            <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit_service&quot;</span><span class="p">,</span>
            <span class="n">context_info</span><span class="o">=</span><span class="n">service_name</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âš ï¸ [yellow]Warning: Failed to create backup, but continuing...[/]&quot;</span><span class="p">)</span>

        <span class="c1"># Load and prepare service data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]YAML syntax error in </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">:[/]&quot;</span><span class="p">)</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error loading YAML:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">services</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;services&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">svc</span> <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">services</span> <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">svc</span><span class="p">,</span> <span class="n">service_name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">service_name</span> <span class="ow">in</span> <span class="n">svc</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [yellow]Service pattern &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39; not found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Handle multiple matches</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">svc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matched</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">. [bold cyan]</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ” [yellow]Multiple services found. Select service (1-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">)</span><span class="si">}</span><span class="s2">): [/]&quot;</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched</span><span class="p">):</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="p">[</span><span class="n">matched</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid selection.[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Invalid input or cancelled.[/]&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Edit each matched service</span>
        <span class="k">for</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">svc_data</span> <span class="o">=</span> <span class="n">services</span><span class="p">[</span><span class="n">svc</span><span class="p">]</span>
            
            <span class="c1"># Create temporary file</span>
            <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.yml&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
                <span class="n">temp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="n">svc</span><span class="p">:</span> <span class="n">svc_data</span><span class="p">},</span> <span class="n">tf</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># def on_save_callback(changed_path, changed=False):</span>
            <span class="c1">#     if changed:</span>
            <span class="c1">#         try:</span>
            <span class="c1">#             with open(changed_path, &#39;r&#39;) as f:</span>
            <span class="c1">#                 edited = yaml.safe_load(f)</span>
                        
            <span class="c1">#             if edited and svc in edited:</span>
            <span class="c1">#                 content[&#39;services&#39;][svc] = edited[svc]</span>
                            
            <span class="c1">#                 # Save main file</span>
            <span class="c1">#                 with open(file_path, &#39;w&#39;) as f:</span>
            <span class="c1">#                     yaml.dump(content, f, sort_keys=False, allow_unicode=True)</span>
                            
            <span class="c1">#                 console.print(f&quot;âœ… [green]Service &#39;{svc}&#39; updated successfully![/]&quot;)</span>
            <span class="c1">#             else:</span>
            <span class="c1">#                 console.print(f&quot;âŒ [red]Invalid service format after editing &#39;{svc}&#39;[/]&quot;)</span>
                            
            <span class="c1">#         except Exception as e:</span>
            <span class="c1">#             console.print(f&quot;âŒ [red]Error updating service:[/] {e}&quot;)</span>
            <span class="c1">#             # Offer backup restoration</span>
            <span class="c1">#             if backup_path and EnhancedBackupManager.prompt_restore_backup(file_path):</span>
            <span class="c1">#                 console.print(&quot;âœ… [green]Backup restored successfully[/]&quot;)</span>
            <span class="c1">#     else:</span>
            <span class="c1">#         console.print(f&quot;â„¹ï¸ [yellow]No changes made to service &#39;{svc}&#39;[/]&quot;)</span>
                
            <span class="c1">#     # Clean up temp file</span>
            <span class="c1">#     try:</span>
            <span class="c1">#         temp_path.unlink()</span>
            <span class="c1">#     except:</span>
            <span class="c1">#         pass</span>

            <span class="k">def</span> <span class="nf">on_save_callback</span><span class="p">(</span><span class="n">changed_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Give file system time to sync</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                        
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">changed_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">edited</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">edited</span> <span class="ow">and</span> <span class="n">svc</span> <span class="ow">in</span> <span class="n">edited</span><span class="p">:</span>
                            <span class="n">content</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">][</span><span class="n">svc</span><span class="p">]</span> <span class="o">=</span> <span class="n">edited</span><span class="p">[</span><span class="n">svc</span><span class="p">]</span>
                            
                            <span class="c1"># Save main file</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            
                            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39; updated successfully![/]&quot;</span><span class="p">)</span>
                            
                            <span class="c1"># Invalidate cache</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">CACHE</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;open_file&quot;</span><span class="p">)</span>
                                <span class="n">CACHE</span><span class="o">.</span><span class="n">invalidate_pattern</span><span class="p">(</span><span class="s2">&quot;yaml:&quot;</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache invalidation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Invalid service format after editing &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;[/]&quot;</span><span class="p">)</span>
                            
                    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]YAML syntax error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âš ï¸ [yellow]Please fix the YAML syntax and try again[/]&quot;</span><span class="p">)</span>
                        <span class="c1"># Offer backup restoration</span>
                        <span class="k">if</span> <span class="n">backup_path</span> <span class="ow">and</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">prompt_restore_backup</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Backup restored successfully[/]&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Error updating service:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                            <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>
                        <span class="c1"># Offer backup restoration</span>
                        <span class="k">if</span> <span class="n">backup_path</span> <span class="ow">and</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">prompt_restore_backup</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âœ… [green]Backup restored successfully[/]&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made to service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39;[/]&quot;</span><span class="p">)</span>
                
                <span class="c1"># Clean up temp file</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">changed_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cleanup temp file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Start editing with monitoring</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ“ [cyan]Opening service &#39;</span><span class="si">{</span><span class="n">svc</span><span class="si">}</span><span class="s2">&#39; for editing...[/]&quot;</span><span class="p">)</span>
            <span class="n">EditorManager</span><span class="o">.</span><span class="n">edit_file_with_monitoring</span><span class="p">(</span>
                <span class="n">temp_path</span><span class="p">,</span>
                <span class="n">callback_on_save</span><span class="o">=</span><span class="n">on_save_callback</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                <span class="n">detached</span><span class="o">=</span><span class="n">detached</span>  <span class="c1"># â† TAMBAHKAN INI</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="EnhancedDDF.edit_dockerfile_enhanced">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF.edit_dockerfile_enhanced">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_dockerfile_enhanced</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enhanced edit_dockerfile with monitoring support.&quot;&quot;&quot;</span>
        <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dockerfile_path</span> <span class="o">=</span> <span class="n">path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dockerfile_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]No Dockerfile path provided or found.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create backup</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">create_backup_with_context</span><span class="p">(</span>
            <span class="n">dockerfile_path</span><span class="p">,</span>
            <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit_dockerfile&quot;</span><span class="p">,</span>
            <span class="n">context_info</span><span class="o">=</span><span class="n">service_name</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_save_callback</span><span class="p">(</span><span class="n">changed_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Dockerfile updated: </span><span class="si">{</span><span class="n">changed_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made to Dockerfile[/]&quot;</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ“ [cyan]Opening Dockerfile for editing...[/]&quot;</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">EditorManager</span><span class="o">.</span><span class="n">edit_file_with_monitoring</span><span class="p">(</span>
            <span class="n">dockerfile_path</span><span class="p">,</span>
            <span class="n">callback_on_save</span><span class="o">=</span><span class="n">on_save_callback</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">detached</span><span class="o">=</span><span class="n">detached</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Failed to open Dockerfile for editing[/]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EnhancedDDF.edit_entrypoint_enhanced">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF.edit_entrypoint_enhanced">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">edit_entrypoint_enhanced</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enhanced edit_entrypoint with monitoring support.&quot;&quot;&quot;</span>
        <span class="n">entrypoint_path</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">read_entrypoint</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entrypoint_path</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]No entrypoint script found for service &#39;</span><span class="si">{</span><span class="n">service_name</span><span class="si">}</span><span class="s2">&#39;.[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Create backup</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">create_backup_with_context</span><span class="p">(</span>
            <span class="n">entrypoint_path</span><span class="p">,</span>
            <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;edit_entrypoint&quot;</span><span class="p">,</span> 
            <span class="n">context_info</span><span class="o">=</span><span class="n">service_name</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_save_callback</span><span class="p">(</span><span class="n">changed_path</span><span class="p">,</span> <span class="n">changed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âœ… [green]Entrypoint script updated: </span><span class="si">{</span><span class="n">changed_path</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;â„¹ï¸ [yellow]No changes made to entrypoint script[/]&quot;</span><span class="p">)</span>

        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ðŸ“ [cyan]Opening entrypoint script for editing...[/]&quot;</span><span class="p">)</span>
        <span class="n">EditorManager</span><span class="o">.</span><span class="n">edit_file_with_monitoring</span><span class="p">(</span>
            <span class="n">entrypoint_path</span><span class="p">,</span>
            <span class="n">callback_on_save</span><span class="o">=</span><span class="n">on_save_callback</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">detached</span><span class="o">=</span><span class="n">detached</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="EnhancedDDF.remove_service_enhanced">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF.remove_service_enhanced">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove_service_enhanced</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enhanced remove_service with backup.&quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        
        <span class="c1"># Create backup before removal</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">EnhancedBackupManager</span><span class="o">.</span><span class="n">create_backup_with_context</span><span class="p">(</span>
            <span class="n">file_path</span><span class="p">,</span>
            <span class="n">operation_type</span><span class="o">=</span><span class="s2">&quot;remove_service&quot;</span><span class="p">,</span>
            <span class="n">context_info</span><span class="o">=</span><span class="n">service_name</span>
        <span class="p">)</span>
        
        <span class="c1"># Proceed with original removal logic</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">remove_service</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="EnhancedDDF.usage_enhanced">
<a class="viewcode-back" href="../../api/core.html#ddf.EnhancedDDF.usage_enhanced">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">usage_enhanced</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enhanced usage method with backup-aware operations.&quot;&quot;&quot;</span>
        <span class="c1"># Add backup-related arguments to parser</span>
        <span class="c1"># This would extend the original usage method</span>
        <span class="c1"># Implementation would mirror original but use enhanced methods</span>
        <span class="k">pass</span></div>
</div>


<div class="viewcode-block" id="Usage">
<a class="viewcode-back" href="../../api/core.html#ddf.Usage">[docs]</a>
<span class="k">class</span> <span class="nc">Usage</span><span class="p">(</span><span class="n">EnhancedDDF</span><span class="p">):</span>

<div class="viewcode-block" id="Usage.usage">
<a class="viewcode-back" href="../../api/core.html#ddf.Usage.usage">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">default_file</span> <span class="o">=</span> <span class="n">CONFIG</span><span class="o">.</span><span class="n">get_config</span><span class="p">(</span><span class="s1">&#39;docker-compose&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;c:\PROJECTS\docker-compose.yml&quot;</span>
        
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Detect or list ports in a Docker Compose file.&quot;</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">CustomRichHelpFormatter</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;service&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Service name to inspect&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default_file</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--list&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List ports for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--detail&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show full configuration for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--find&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Find port in all services&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--port&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Check if PORT is duplicate among all services&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-D&#39;</span><span class="p">,</span> <span class="s1">&#39;--device&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show devices for the given service or all services&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-vol&#39;</span><span class="p">,</span> <span class="s1">&#39;--volumes&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show devices for the given service or all services&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-V&#39;</span><span class="p">,</span> <span class="s1">&#39;--VOLUMES&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show Volumes Section&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-P&#39;</span><span class="p">,</span> <span class="s1">&#39;--list-port&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all ports in the YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-L&#39;</span><span class="p">,</span> <span class="s1">&#39;--list-service-name&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;List all service names in the YAML file&quot;</span><span class="p">)</span>
        <span class="c1"># parser.add_argument(&#39;-r&#39;, &#39;--dockerfile&#39;, metavar=&#39;SERVICE&#39;, help=&quot;Read and display the Dockerfile for the given service&quot;)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display the Dockerfile for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the Dockerfile for the given service using nvim, nano, or vim&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-sd&#39;</span><span class="p">,</span> <span class="s1">&#39;--set-dockerfile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;DOCKERFILE_PATH&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the Dockerfile path for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-E&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-service&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the service section for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dd&#39;</span><span class="p">,</span> <span class="s1">&#39;--duplicate-service&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;NEW_SERVICE_NAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Duplicate the service section with a new service name&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cs&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-service&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;copy service section to clipboar&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rn&#39;</span><span class="p">,</span> <span class="s1">&#39;--rename-service&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;NEW_SERVICE_NAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Rename the service section to a new name&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-cd&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-dockerfile&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Copy the Dockerfile content to clipboard&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-en&#39;</span><span class="p">,</span> <span class="s1">&#39;--entrypoint&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display the entrypoint script for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-ed&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-entrypoint&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit the entrypoint script for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rm&#39;</span><span class="p">,</span> <span class="s1">&#39;--remove-service&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Remove the service section for the given service&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--all&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show all services and their ports, devices, and volumes&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-nl&#39;</span><span class="p">,</span> <span class="s1">&#39;--no-line-numbers&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Disable line numbers in syntax highlighting&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-hn&#39;</span><span class="p">,</span> <span class="s1">&#39;--hostname&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show hostname for the service if available&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--new&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Create a new service section in the YAML file&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-F&#39;</span><span class="p">,</span> <span class="s1">&#39;--filter&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Filter services by name or pattern&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;%(prog)s </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_version</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show the version of ddf module&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-ef&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Edit a specific file in the Dockerfile COPY command&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-rf&#39;</span><span class="p">,</span> <span class="s1">&#39;--read-file&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Read and display a specific file in the Dockerfile COPY command&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--theme&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;fruity&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set the theme for syntax highlighting (default: fruity)&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--server-mode&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">SUPPRESS</span><span class="p">)</span>  <span class="c1"># hidden</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-hc&#39;</span><span class="p">,</span> <span class="s1">&#39;--health-check&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Check server health status&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span>  <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>  <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Turn on debug mode&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-dt&#39;</span><span class="p">,</span> <span class="s1">&#39;--detach&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> 
                   <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Open editor in new terminal window (for nano, nvim, vim)&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">DDF</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">default_file</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">find_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>                
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;-h&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s1">&#39;--help&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="c1"># args = parser.parse_args()</span>

        <span class="c1"># =============== SERVER MODE INTEGRATION ===============</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        
        
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LOGGING&quot;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">})</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;NO_LOGGING&quot;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">})</span>
        
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">health_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_server_running</span><span class="p">():</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;âŒ [red]Server is not running[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Send health check request via socket</span>
                <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">))</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;health_check&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                    <span class="n">health_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                    
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ðŸ¥ [bold cyan]Server Health Check:[/]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">health_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;âœ…&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;âŒ&quot;</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;red&quot;</span>
                        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2"> [bold]</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">:[/] [</span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">]</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                    
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">health_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;âŒ [red]Health check failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Handle server mode launch</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">server_mode</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">server</span> <span class="o">=</span> <span class="n">DDFServer</span><span class="p">()</span>
                <span class="n">server</span><span class="o">.</span><span class="n">setup_tray</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[red]Server mode not available. Install: pystray Pillow plyer[/]&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Auto-forward ONLY editing commands</span>
        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[bold #00FFFF]SERVER_ACTIVE:[/] [bold #FFFF00]</span><span class="si">{</span><span class="n">SERVER_ACTIVE</span><span class="si">}</span><span class="s2">[/]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SERVER_ACTIVE</span><span class="p">:</span>
            <span class="n">editing_triggers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;-E&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-service&#39;</span><span class="p">,</span> <span class="s1">&#39;-ed&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-entrypoint&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;-ef&#39;</span><span class="p">,</span> <span class="s1">&#39;--edit-file&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--new&#39;</span><span class="p">,</span> <span class="s1">&#39;-rm&#39;</span><span class="p">,</span> <span class="s1">&#39;--remove-service&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;-rn&#39;</span><span class="p">,</span> <span class="s1">&#39;--rename-service&#39;</span><span class="p">,</span> <span class="s1">&#39;-dd&#39;</span><span class="p">,</span> <span class="s1">&#39;--duplicate-service&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;-cs&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-service&#39;</span><span class="p">,</span> <span class="s1">&#39;-cd&#39;</span><span class="p">,</span> <span class="s1">&#39;--copy-dockerfile&#39;</span><span class="p">,</span> <span class="s1">&#39;-sd&#39;</span><span class="p">,</span> <span class="s1">&#39;--set-dockerfile&#39;</span><span class="p">}</span>
            <span class="n">skip_triggers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">}</span>
            <span class="n">cli_args</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">cli_args</span> <span class="o">&amp;</span> <span class="n">editing_triggers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cli_args</span> <span class="o">&amp;</span> <span class="n">skip_triggers</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">is_server_running</span><span class="p">():</span>
                    <span class="n">send_to_server</span><span class="p">({</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot;cwd&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()})</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[cyan]ðŸ“¤ Command sent to background server.[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[yellow]âš ï¸ Server mode active but server not running. Starting in background...[/]&quot;</span><span class="p">)</span>
                    <span class="n">startupinfo</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">STARTUPINFO</span><span class="p">(</span><span class="n">dwFlags</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STARTF_USESHOWWINDOW</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;--server-mode&#39;</span><span class="p">],</span>
                                   <span class="n">startupinfo</span><span class="o">=</span><span class="n">startupinfo</span><span class="p">,</span>
                                   <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                                   <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                                   <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
                    <span class="n">send_to_server</span><span class="p">({</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot;cwd&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()})</span>
                    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;[cyan]ðŸ“¤ Command sent to newly started server.[/]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
        <span class="c1"># =======================================================</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">):</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]YAML file not found:[/] </span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [red]Error:[/] </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;TRACEBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">]:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print_exception</span><span class="p">()</span>            
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">theme</span><span class="p">:</span>
            <span class="c1"># console.set_theme(args.theme)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">THEME</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">theme</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">list_service_devices</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">list_service_volumes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">VOLUMES</span><span class="p">:</span>
            <span class="n">DDF</span><span class="o">.</span><span class="n">list_volumes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">list_port</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">list_service_ports</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service specified for listing ports.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">hostname</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">list_hostnames</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">check_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">find</span> <span class="ow">or</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">find_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">find</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">False</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span> <span class="k">else</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">detail</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">show_service_detail</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">list</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">list_service_ports</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">dockerfile</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">read_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">entrypoint</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">read_entrypoint</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_entrypoint</span><span class="p">:</span>
            <span class="c1"># cls.edit_entrypoint(service_name=args.service)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">edit_entrypoint_enhanced</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="n">ars</span><span class="o">.</span><span class="n">detach</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">remove_service</span><span class="p">:</span>
            <span class="c1"># cls.remove_service(args.service)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">remove_service_enhanced</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">:</span>
            <span class="c1"># cls.edit_dockerfile(service_name=args.service)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">edit_dockerfile_enhanced</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">detached</span><span class="o">=</span><span class="n">ars</span><span class="o">.</span><span class="n">detach</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No Dockerfile path provided for setting.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">set_dockerfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_dockerfile</span><span class="p">:</span>
                <span class="c1"># cls.edit_dockerfile(service_name=args.service)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">edit_dockerfile_enhanced</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_service</span><span class="p">:</span>
                <span class="c1"># cls.edit_service(file_path=args.file, service_name=args.service)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">edit_service_enhanced</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">dockerfile</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">read_dockerfile</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No filename provided for editing.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">edit_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">edit_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No filename provided for reading.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">read_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">line_numbers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_line_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">list_service_name</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">list_service_names</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">edit_service</span><span class="p">:</span>
            <span class="c1"># cls.edit_service(file_path=args.file, service_name=args.service)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">edit_service_enhanced</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">new</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for new service.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">new_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">copy_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">copy_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">copy_dockerfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying Dockerfile.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">copy_dockerfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">rename_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for copying Dockerfile.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">rename_service</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">rename_service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">duplicate_service</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">âŒ [white on red]No service name provided for duplication.[/]&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">duplicate_server</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">duplicate_service</span><span class="p">)</span>
        <span class="c1">#if only service is provided, check for duplicate ports</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">_option_string_actions</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">debug</span><span class="p">(</span><span class="n">len_filter__option_string_actions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]))))</span>
        <span class="c1"># if args.service and not (args.list or args.detail or args.dockerfile or args.entrypoint or args.edit_dockerfile or args.edit_entrypoint or args.set_dockerfile or args.edit_service or args.remove_service or args.copy_service or args.copy_dockerfile or args.duplicate_service):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_option_string_actions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])))</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">find_duplicate_port</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">target_service</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">service</span><span class="p">)</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># EnhancedDDF.usage()</span>
    <span class="c1"># Cleanup old temp files on startup</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">EditorManager</span><span class="o">.</span><span class="n">cleanup_temp_files</span><span class="p">(</span><span class="n">max_age_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to cleanup temp files: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">Usage</span><span class="o">.</span><span class="n">usage</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hadi Cahyadi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>